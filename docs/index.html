<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Yale University Executive Order Analysis Assistant - Tracking and analyzing executive orders that impact university operations and compliance">
    <meta name="keywords" content="Yale, executive orders, university impact, higher education, compliance, research funding">
    <title>Yale Executive Order Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“œ</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a56db;
            --primary-hover: #1e429f;
            --secondary: #e5e7eb;
            --accent: #f97316;
            --danger: #ef4444;
            --success: #10b981;
            --neutral: #6b7280;
            --yale-blue: #00356b;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #111827;
        }
        
        .app-container {
            max-width: 1400px;
        }
        
        .card {
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .btn-primary {
            background-color: var(--yale-blue);
            color: white;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background-color: #002548;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: #374151;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        
        .btn-outline {
            background-color: white;
            color: var(--yale-blue);
            border: 1px solid var(--yale-blue);
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-outline:hover {
            background-color: #f0f9ff;
        }
        
        .search-input {
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            width: 100%;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--yale-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .select-input {
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.5rem 2rem 0.5rem 0.75rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.25em 1.25em;
        }
        
        .select-input:focus {
            outline: none;
            border-color: var(--yale-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .data-table th {
            background-color: #f9fafb;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            color: #374151;
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: top;
        }
        
        .data-table tr:hover {
            background-color: #f9fafb;
        }
        
        .impact-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1;
        }
        
        .impact-critical {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .impact-high {
            background-color: #fff7ed;
            color: #c2410c;
        }
        
        .impact-medium {
            background-color: #ecfdf5;
            color: #047857;
        }
        
        .impact-low {
            background-color: #f3f4f6;
            color: #4b5563;
        }
        
        .tag {
            display: inline-flex;
            align-items: center;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: #f3f4f6;
            color: #4b5563;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 50;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }
        
        .modal-backdrop.hidden {
            display: none;
        }
        
        .modal-content {
            width: 95%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 51;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            background-color: white;
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 2;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-footer {
            position: sticky;
            bottom: 0;
            background-color: white;
            z-index: 2;
            border-top: 1px solid #e5e7eb;
        }
        
        .close-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            background-color: #f3f4f6;
            color: #4b5563;
            transition: all 0.2s;
        }
        
        .close-button:hover {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        
        .tab-button {
            padding: 0.75rem 1rem;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab-button:hover {
            color: #1f2937;
        }
        
        .tab-button.active {
            color: var(--yale-blue);
            border-bottom-color: var(--yale-blue);
        }
        
        .animated-fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .modal-content {
                width: 100%;
                max-height: 100vh;
                border-radius: 0;
            }
            
            .tab-button {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }

        /* Yale-specific styles */
        .yale-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1;
        }
        
        .yale-tag {
            display: inline-flex;
            align-items: center;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
        }

        #toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 100;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        .opacity-0 {
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="app-container mx-auto p-4 sm:p-6">
        <!-- Header: Simple and focused -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div>
                <h1 class="text-2xl font-bold flex items-center">
                    <span class="text-xl mr-2">ðŸ“œ</span>
                    Yale Executive Order Tracker
                </h1>
                <p class="text-gray-600 mt-1">Monitoring orders that impact university operations and compliance</p>
            </div>
            <div class="flex gap-3">
                <span id="last-updated" class="text-sm text-gray-500 flex items-center">
                    <i class="far fa-clock mr-1"></i>
                    Last updated: <span id="update-date">Loading...</span>
                </span>
            </div>
        </header>
        
        <!-- Main content: Filters and Table in one card -->
        <div class="card mb-6">
            <!-- Search and filters bar -->
            <div class="border-b border-gray-200 p-4">
                <div class="flex flex-col lg:flex-row gap-4">
                    <!-- Search box - prominent for quick access -->
                    <div class="relative flex-grow">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" id="search-input" placeholder="Search executive orders..." 
                               class="search-input pl-10 py-2 focus:ring-2 focus:ring-blue-100" />
                    </div>
                    
                    <!-- Filter controls - in row for desktop, stacked for mobile -->
                    <div class="flex flex-wrap gap-2 lg:items-center">
                        <select id="filter-impact-level" class="select-input min-w-[140px]">
                            <option value="">All Impact Levels</option>
                            <option value="Critical">Critical</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                        
                        <select id="filter-university-area" class="select-input min-w-[180px]">
                            <option value="">All Impact Areas</option>
                            <!-- Populated dynamically -->
                        </select>
                        
                        <select id="filter-category" class="select-input min-w-[150px]">
                            <option value="">All Categories</option>
                            <!-- Populated dynamically -->
                        </select>
                        
                        <button id="clear-filters-btn" class="btn-secondary py-2 px-3 flex items-center">
                            <i class="fas fa-times mr-2"></i>Reset
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Table with executive orders - the central focus -->
            <div class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th scope="col" data-sort="order_number" class="cursor-pointer">
                                <div class="flex items-center">
                                    <span>Order #</span>
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th scope="col" data-sort="title" class="cursor-pointer">
                                <div class="flex items-center">
                                    <span>Title</span>
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th scope="col" data-sort="signing_date" class="cursor-pointer">
                                <div class="flex items-center">
                                    <span>Date</span>
                                    <i class="fas fa-sort-down ml-1 text-blue-700"></i>
                                </div>
                            </th>
                            <th scope="col" data-sort="impact_level" class="cursor-pointer">
                                <div class="flex items-center">
                                    <span>Impact</span>
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th scope="col">Areas</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="eo-table-body">
                        <tr>
                            <td colspan="6" class="text-center py-12">
                                <div class="flex flex-col items-center">
                                    <i class="fas fa-spinner fa-spin text-blue-700 text-2xl mb-3"></i>
                                    <p class="text-gray-500">Loading executive orders...</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Detail View Modal (hidden by default) -->
        <div id="detail-view" class="modal-backdrop hidden">
            <div class="modal-content animated-fade-in">
                <!-- Modal Header -->
                <div class="modal-header p-6">
                    <div class="flex justify-between items-center">
                        <h3 id="detail-title" class="text-xl font-semibold text-gray-900"></h3>
                        <button id="close-detail-btn" class="close-button" aria-label="Close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <p class="text-sm text-gray-500 mt-1 mb-3">
                        <span id="detail-order-number" class="font-medium"></span> | 
                        Signed by <span id="detail-president"></span> on 
                        <span id="detail-date"></span>
                    </p>
                    
                    <!-- Tabs -->
                    <div class="flex border-b border-gray-200">
                        <button class="tab-button active" data-tab="summary">
                            <i class="far fa-file-alt mr-2"></i>Original Summary
                        </button>
                        <button class="tab-button" data-tab="plain-summary">
                            <i class="fas fa-file-alt mr-2"></i>Plain Language Summary
                        </button>
                    </div>
                </div>
                
                <!-- Modal Body -->
                <div id="tab-content" class="p-6">
                    <!-- Summary Tab (active by default) -->
                    <div id="summary-tab" class="tab-content">
                        <div class="flex flex-col md:flex-row gap-6">
                            <!-- Main summary content -->
                            <div class="flex-grow">
                                <div class="prose max-w-none mb-6">
                                    <h4 class="text-lg font-medium mb-2">Executive Summary</h4>
                                    <p id="detail-summary" class="text-gray-700"></p>
                                </div>
                                
                                <div class="mb-6">
                                    <h4 class="text-lg font-medium mb-4">University Impact Areas</h4>
                                    <div id="detail-university-impact-areas" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                                </div>
                            </div>
                            
                            <!-- Info panel -->
                            <div class="w-full md:w-80 lg:w-96 shrink-0">
                                <div class="card p-4 mb-4">
                                    <h5 class="font-medium text-gray-700 text-sm uppercase tracking-wider mb-3">Impact Assessment</h5>
                                    <div id="detail-impact-level" class="yale-badge mb-4"></div>
                                    
                                    <h6 class="text-xs uppercase text-gray-500 font-medium mt-4 mb-2">Categories</h6>
                                    <div id="detail-categories" class="flex flex-wrap gap-1 mb-4"></div>
                                    
                                    <h6 class="text-xs uppercase text-gray-500 font-medium mt-4 mb-2">Impact Areas</h6>
                                    <div id="detail-impact-areas" class="flex flex-wrap gap-1"></div>
                                    
                                    <div class="mt-6 pt-4 border-t border-gray-100">
                                        <a id="detail-url" href="#" target="_blank" class="btn-primary w-full py-2 px-4 flex items-center justify-center">
                                            <i class="fas fa-external-link-alt mr-2"></i>View Full Text
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Plain Language Summary Tab -->
                    <div id="plain-summary-tab" class="tab-content hidden">
                        <div id="plain-summary-content" class="mb-6">
                            <div class="flex justify-center items-center py-8">
                                <div class="flex flex-col items-center">
                                    <i class="fas fa-spinner fa-spin text-blue-700 text-2xl mb-3"></i>
                                    <p class="text-gray-500">Loading plain language summary...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer p-4 flex justify-between items-center border-t border-gray-200">
                    <span class="text-xs text-gray-500">Analyzed with Claude AI</span>
                    <button class="btn-secondary px-4 py-2" onclick="document.getElementById('detail-view').classList.add('hidden')">
                        Close
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Stats summary cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="card p-4">
                <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-1">Total Orders</h3>
                <div class="flex items-baseline">
                    <span id="total-orders-count" class="text-2xl font-semibold">--</span>
                    <span class="text-sm text-gray-500 ml-2">executive orders</span>
                </div>
            </div>
            
            <div class="card p-4">
                <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-1">Critical Impact</h3>
                <div class="flex items-baseline">
                    <span id="critical-impact-count" class="text-2xl font-semibold text-red-600">--</span>
                    <span class="text-sm text-gray-500 ml-2">require immediate action</span>
                </div>
            </div>
            
            <div class="card p-4">
                <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-1">Top Impact Area</h3>
                <div id="top-impact-area" class="text-2xl font-semibold truncate">--</div>
            </div>
            
            <div class="card p-4">
                <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-1">Recent Activity</h3>
                <div class="flex items-baseline">
                    <span id="recent-orders-count" class="text-2xl font-semibold">--</span>
                    <span class="text-sm text-gray-500 ml-2">in last 90 days</span>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="border-t border-gray-200 pt-4 mt-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <span class="text-sm text-gray-500" id="system-info">Yale Executive Order Tracker | Static Version</span>
                </div>
                <div class="flex items-center">
                    <span class="text-xs text-gray-400">Powered by Claude AI | <a href="https://github.com/yourusername/yale-executive-orders" class="text-blue-500 hover:text-blue-700">GitHub</a></span>
                </div>
            </div>
        </footer>

        <!-- Toast container -->
        <div id="toast-container"></div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM elements
            const searchInput = document.getElementById('search-input');
            const filterCategory = document.getElementById('filter-category');
            const filterImpactLevel = document.getElementById('filter-impact-level');
            const filterUniversityArea = document.getElementById('filter-university-area');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const eoTableBody = document.getElementById('eo-table-body');
            const systemInfo = document.getElementById('system-info');
            const detailView = document.getElementById('detail-view');
            const closeDetailBtn = document.getElementById('close-detail-btn');
            const updateDate = document.getElementById('update-date');
            
            // Stat elements
            const totalOrdersCount = document.getElementById('total-orders-count');
            const criticalImpactCount = document.getElementById('critical-impact-count');
            const topImpactArea = document.getElementById('top-impact-area');
            const recentOrdersCount = document.getElementById('recent-orders-count');
            
            // Detail view elements
            const detailTitle = document.getElementById('detail-title');
            const detailOrderNumber = document.getElementById('detail-order-number');
            const detailPresident = document.getElementById('detail-president');
            const detailDate = document.getElementById('detail-date');
            const detailSummary = document.getElementById('detail-summary');
            const detailImpactLevel = document.getElementById('detail-impact-level');
            const detailCategories = document.getElementById('detail-categories');
            const detailImpactAreas = document.getElementById('detail-impact-areas');
            const detailUniversityImpactAreas = document.getElementById('detail-university-impact-areas');
            const detailUrl = document.getElementById('detail-url');
            
            // Data storage
            let allExecutiveOrders = [];
            let metadata = {
                categories: [],
                impactAreas: [],
                universityImpactAreas: []
            };
            let statistics = {};
            let systemInfoData = {};
            let sortField = 'signing_date';
            let sortDirection = 'desc';
            
            // Tab handling
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Hide all tab contents
                    tabContents.forEach(content => content.classList.add('hidden'));
                    
                    // Show selected tab content
                    const tabName = tab.getAttribute('data-tab');
                    document.getElementById(`${tabName}-tab`).classList.remove('hidden');
                });
            });
            
            // Fetch system info
            async function getSystemInfo() {
                try {
                    const response = await fetch('data/system_info.json');
                    if (!response.ok) {
                        throw new Error('Failed to get system info');
                    }
                    
                    const data = await response.json();
                    systemInfoData = data;
                    
                    // Update system info
                    systemInfo.textContent = `${data.topicName} | Static Version`;
                    
                    // Update last updated date
                    const lastUpdated = new Date(data.lastUpdated);
                    updateDate.textContent = lastUpdated.toLocaleDateString();
                    
                    // Update order count in stats
                    totalOrdersCount.textContent = data.orderCount;
                    
                } catch (error) {
                    console.error('Error getting system info:', error);
                    systemInfo.textContent = 'Yale Executive Order Tracker | Static Version';
                }
            }
            
            // Fetch and display the plain language summary
            async function fetchPlainLanguageSummary(orderId) {
                try {
                    const plainSummaryContent = document.getElementById('plain-summary-content');
                    plainSummaryContent.innerHTML = `
                        <div class="flex justify-center items-center py-8">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-spinner fa-spin text-blue-700 text-2xl mb-3"></i>
                                <p class="text-gray-500">Loading plain language summary...</p>
                            </div>
                        </div>
                    `;
                    
                    // In static version, fetch the HTML file directly
                    const response = await fetch(`data/summaries/${orderId}.html`);
                    
                    if (!response.ok) {
                        if (response.status === 404) {
                            // No summary available
                            plainSummaryContent.innerHTML = `
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center">
                                    <i class="fas fa-file-alt text-gray-400 text-4xl mb-4"></i>
                                    <h3 class="text-lg font-medium text-gray-800 mb-2">No Plain Language Summary Available</h3>
                                    <p class="text-gray-500">A plain language summary has not been generated for this executive order yet.</p>
                                </div>
                            `;
                            return;
                        }
                        throw new Error(`Status: ${response.status}`);
                    }
                    
                    const htmlContent = await response.text();
                    
                    // Display the plain language summary (which is already HTML formatted)
                    plainSummaryContent.innerHTML = htmlContent;
                    
                } catch (error) {
                    console.error('Error fetching plain language summary:', error);
                    document.getElementById('plain-summary-content').innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
                            <i class="fas fa-exclamation-circle text-red-500 text-4xl mb-4"></i>
                            <h3 class="text-lg font-medium text-red-800 mb-2">Error Loading Summary</h3>
                            <p class="text-red-500">There was an error loading the plain language summary. Please try again later.</p>
                        </div>
                    `;
                }
            }
            
            // Load metadata (categories, impact areas, etc.)
            async function loadMetadata() {
                try {
                    const response = await fetch('data/metadata.json');
                    if (!response.ok) {
                        throw new Error('Failed to fetch metadata');
                    }
                    
                    metadata = await response.json();
                    
                    // Populate filter options
                    populateFilterOptions();
                    
                } catch (error) {
                    console.error('Error loading metadata:', error);
                    showToast('Error', 'Failed to load category data', 'error');
                }
            }
            
            // Load executive orders
            async function loadExecutiveOrders() {
                try {
                    const response = await fetch('data/executive_orders.json');
                    if (!response.ok) {
                        throw new Error('Failed to fetch executive orders');
                    }
                    
                    allExecutiveOrders = await response.json();
                    
                    // Render the table
                    renderExecutiveOrdersTable();
                    
                    // Load statistics
                    loadStatistics();
                    
                    // Update dashboard stats
                    updateDashboardStats(allExecutiveOrders);
                    
                } catch (error) {
                    console.error('Error loading executive orders:', error);
                    eoTableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-10 text-red-500">
                                <div class="flex flex-col items-center">
                                    <i class="fas fa-exclamation-circle text-red-500 text-2xl mb-3"></i>
                                    <p>Error loading executive orders. Please try again later.</p>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }
            
            // Update dashboard stats based on orders data
            function updateDashboardStats(orders) {
                if (!orders || !orders.length) return;
                
                // Count critical impact orders
                const criticalOrders = orders.filter(order => order.impact_level === 'Critical');
                criticalImpactCount.textContent = criticalOrders.length;
                
                // Find top university impact area
                const impactAreaCounts = {};
                orders.forEach(order => {
                    if (order.university_impact_areas && order.university_impact_areas.length) {
                        order.university_impact_areas.forEach(area => {
                            const areaName = typeof area === 'string' ? area : area.name;
                            impactAreaCounts[areaName] = (impactAreaCounts[areaName] || 0) + 1;
                        });
                    }
                });
                
                // Sort impact areas by count
                const sortedAreas = Object.entries(impactAreaCounts)
                    .sort((a, b) => b[1] - a[1]);
                
                if (sortedAreas.length) {
                    topImpactArea.textContent = sortedAreas[0][0];
                } else {
                    topImpactArea.textContent = 'None';
                }
                
                // Count recent orders (last 90 days)
                const ninetyDaysAgo = new Date();
                ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
                
                const recentOrders = orders.filter(order => {
                    if (!order.signing_date) return false;
                    return new Date(order.signing_date) >= ninetyDaysAgo;
                });
                
                recentOrdersCount.textContent = recentOrders.length;
            }
            
            // Load statistics
            async function loadStatistics() {
                try {
                    const response = await fetch('data/statistics.json');
                    if (!response.ok) {
                        throw new Error('Failed to fetch statistics');
                    }
                    
                    statistics = await response.json();
                    
                } catch (error) {
                    console.error('Error loading statistics:', error);
                }
            }
            
            // Populate filter options from metadata
            function populateFilterOptions() {
                // Categories
                if (metadata.categories && metadata.categories.length) {
                    // Clear existing options (except the first one)
                    filterCategory.innerHTML = '<option value="">All Categories</option>';
                    
                    // Sort categories by name
                    const sortedCategories = metadata.categories.sort((a, b) => a.name.localeCompare(b.name));
                    
                    // Add new options
                    sortedCategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = category.name;
                        filterCategory.appendChild(option);
                    });
                }
                
                // University impact areas
                if (metadata.universityImpactAreas && metadata.universityImpactAreas.length) {
                    // Clear existing options (except the first one)
                    filterUniversityArea.innerHTML = '<option value="">All Impact Areas</option>';
                    
                    // Sort university impact areas by name
                    const sortedAreas = metadata.universityImpactAreas.sort((a, b) => a.name.localeCompare(b.name));
                    
                    // Add new options
                    sortedAreas.forEach(area => {
                        const option = document.createElement('option');
                        option.value = area.name;
                        option.textContent = area.name;
                        filterUniversityArea.appendChild(option);
                    });
                }
            }
            
            // Render executive orders table
            function renderExecutiveOrdersTable() {
                // Get filter values
                const categoryFilter = filterCategory.value;
                const impactLevelFilter = filterImpactLevel.value;
                const universityAreaFilter = filterUniversityArea.value;
                const searchText = searchInput.value.toLowerCase();
                
                // Apply filters
                const filteredOrders = allExecutiveOrders.filter(order => {
                    // Category filter
                    if (categoryFilter && (!order.categories || !order.categories.includes(categoryFilter))) {
                        return false;
                    }
                    
                    // Impact level filter
                    if (impactLevelFilter && order.impact_level !== impactLevelFilter) {
                        return false;
                    }
                    
                    // University impact area filter
                    if (universityAreaFilter) {
                        if (!order.university_impact_areas || !order.university_impact_areas.length) {
                            return false;
                        }
                        
                        // Check if any of the impact areas match the filter
                        const hasMatchingArea = order.university_impact_areas.some(area => {
                            const areaName = typeof area === 'string' ? area : (area.name || '');
                            return areaName === universityAreaFilter;
                        });
                        
                        if (!hasMatchingArea) {
                            return false;
                        }
                    }
                    
                    // Search text filter
                    if (searchText) {
                        const searchFields = [
                            order.order_number,
                            order.title,
                            order.summary,
                            order.president
                        ].map(field => field ? field.toLowerCase() : '');
                        
                        return searchFields.some(field => field.includes(searchText));
                    }
                    
                    return true;
                });
                
                // Sort the orders
                filteredOrders.sort((a, b) => {
                    let aValue = a[sortField];
                    let bValue = b[sortField];
                    
                    // Handle null values
                    if (aValue === null || aValue === undefined) return 1;
                    if (bValue === null || bValue === undefined) return -1;
                    
                    // Format values for comparison
                    if (sortField === 'signing_date') {
                        aValue = new Date(aValue);
                        bValue = new Date(bValue);
                    }
                    
                    // Compare values
                    if (aValue < bValue) {
                        return sortDirection === 'asc' ? -1 : 1;
                    }
                    if (aValue > bValue) {
                        return sortDirection === 'asc' ? 1 : -1;
                    }
                    return 0;
                });
                
                // Clear the table body
                eoTableBody.innerHTML = '';
                
                // Check if we have any results
                if (filteredOrders.length === 0) {
                    eoTableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-10">
                                <div class="flex flex-col items-center">
                                    <i class="fas fa-filter text-gray-400 text-2xl mb-3"></i>
                                    <p class="text-gray-500">No executive orders match the selected filters.</p>
                                    <button id="reset-filters" class="btn-secondary mt-3 px-3 py-1 text-sm">Reset Filters</button>
                                </div>
                            </td>
                        </tr>
                    `;
                    document.getElementById('reset-filters')?.addEventListener('click', () => {
                        clearFiltersBtn.click();
                    });
                    return;
                }
                
                // Add rows for each order
                filteredOrders.forEach(order => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    
                    // Format date
                    const dateFormatted = order.signing_date ? 
                        new Date(order.signing_date).toLocaleDateString('en-US', {
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric'
                        }) : 'N/A';
                    
                    // Determine impact level class
                    let impactBadgeClass = 'impact-medium';
                    if (order.impact_level === 'Critical') {
                        impactBadgeClass = 'impact-critical';
                    } else if (order.impact_level === 'High') {
                        impactBadgeClass = 'impact-high';
                    } else if (order.impact_level === 'Low') {
                        impactBadgeClass = 'impact-low';
                    }
                    
                    // Create a truncated summary
                    const truncatedSummary = order.summary 
                        ? (order.summary.length > 120 ? order.summary.substring(0, 120) + '...' : order.summary)
                        : '';
                    
                    // Create table row
                    row.innerHTML = `
                        <td class="font-medium">
                            ${order.order_number || 'N/A'}
                        </td>
                        <td>
                            <div>
                                <div class="font-medium text-blue-700 hover:text-blue-900 cursor-pointer view-details" data-id="${order.id}">
                                    ${order.title || 'N/A'}
                                </div>
                                <p class="text-xs text-gray-500 mt-1">${truncatedSummary}</p>
                            </div>
                        </td>
                        <td class="text-gray-600 whitespace-nowrap">
                            ${dateFormatted}
                        </td>
                        <td>
                            <span class="impact-badge ${impactBadgeClass}">
                                ${order.impact_level || 'Unknown'}
                            </span>
                        </td>
                        <td>
                            <div class="flex flex-wrap gap-1">
                                ${order.university_impact_areas && order.university_impact_areas.length ? 
                                    order.university_impact_areas.slice(0, 2).map(area => {
                                        const areaName = typeof area === 'string' ? area : (area.name || '');
                                        return `<span class="tag">${areaName.split(' ')[0]}</span>`;
                                    }).join('') + 
                                    (order.university_impact_areas.length > 2 ? 
                                        `<span class="tag">+${order.university_impact_areas.length - 2}</span>` : '')
                                    : '<span class="text-gray-400 text-sm">None</span>'}
                            </div>
                        </td>
                        <td class="whitespace-nowrap">
                            <div class="flex gap-2">
                                <button class="btn-primary py-1 px-3 text-xs view-details" data-id="${order.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <a href="${order.url || '#'}" target="_blank" class="btn-secondary py-1 px-3 text-xs" title="View original source">
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        </td>
                    `;
                    
                    eoTableBody.appendChild(row);
                    
                    // Add event listeners for view details buttons
                    row.querySelectorAll('.view-details').forEach(button => {
                        button.addEventListener('click', () => {
                            const id = button.getAttribute('data-id');
                            viewOrderDetails(id);
                        });
                    });
                });
            }
            
            // View order details
            async function viewOrderDetails(id) {
                try {
                    // Get the order details from the allExecutiveOrders array
                    const order = allExecutiveOrders.find(o => o.id === parseInt(id, 10) || o.id === id);
                    
                    if (!order) {
                        throw new Error('Order not found');
                    }
                    
                    // Populate detail view
                    detailTitle.textContent = order.title;
                    detailOrderNumber.textContent = order.order_number;
                    detailPresident.textContent = order.president;
                    
                    // Format date
                    const dateFormatted = order.signing_date ? 
                        new Date(order.signing_date).toLocaleDateString('en-US', {
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric'
                        }) : 'N/A';
                    
                    detailDate.textContent = dateFormatted;
                    
                    detailSummary.textContent = order.summary;
                    
                    // Set impact level badge
                    let impactBadgeClass = 'bg-blue-100 text-blue-800';
                    if (order.impact_level === 'Critical') {
                        impactBadgeClass = 'bg-red-100 text-red-800';
                    } else if (order.impact_level === 'High') {
                        impactBadgeClass = 'bg-yellow-100 text-yellow-800';
                    } else if (order.impact_level === 'Low') {
                        impactBadgeClass = 'bg-green-100 text-green-800';
                    }
                    
                    detailImpactLevel.className = `yale-badge ${impactBadgeClass}`;
                    detailImpactLevel.textContent = order.impact_level || 'Unknown';
                    
                    // Set categories
                    detailCategories.innerHTML = '';
                    if (order.categories && order.categories.length > 0) {
                        order.categories.forEach(category => {
                            const tag = document.createElement('span');
                            tag.className = 'yale-tag bg-blue-100 text-blue-800';
                            tag.textContent = category;
                            detailCategories.appendChild(tag);
                        });
                    } else {
                        detailCategories.textContent = 'No categories specified';
                    }
                    
                    // Set impact areas
                    detailImpactAreas.innerHTML = '';
                    if (order.impact_areas && order.impact_areas.length > 0) {
                        order.impact_areas.forEach(area => {
                            const tag = document.createElement('span');
                            tag.className = 'yale-tag bg-green-100 text-green-800';
                            tag.textContent = area;
                            detailImpactAreas.appendChild(tag);
                        });
                    } else {
                        detailImpactAreas.textContent = 'No impact areas specified';
                    }
                    
                    // Set university impact areas
                    detailUniversityImpactAreas.innerHTML = '';
                    if (order.university_impact_areas && order.university_impact_areas.length > 0) {
                        order.university_impact_areas.forEach(area => {
                            // Get area name (handle both string and object formats)
                            const areaName = typeof area === 'string' ? area : area.name;
                            const areaDescription = typeof area === 'object' && area.description ? area.description : '';
                            const areaNotes = typeof area === 'object' && area.notes ? area.notes : '';
                            
                            // Create university impact area card
                            const card = document.createElement('div');
                            card.className = 'border border-gray-200 rounded-lg p-4 bg-indigo-50';
                            
                            // Determine icon based on area name
                            let iconClass = 'fas fa-university';
                            if (areaName === 'Research Funding') {
                                iconClass = 'fas fa-flask';
                            } else if (areaName === 'Student Aid & Higher Education Finance') {
                                iconClass = 'fas fa-graduation-cap';
                            } else if (areaName === 'Administrative Compliance') {
                                iconClass = 'fas fa-clipboard-check';
                            } else if (areaName === 'Workforce & Employment Policy') {
                                iconClass = 'fas fa-users';
                            } else if (areaName === 'Public-Private Partnerships') {
                                iconClass = 'fas fa-handshake';
                            }
                            
                            card.innerHTML = `
                                <div class="flex items-center mb-2">
                                    <i class="${iconClass} text-[#00356B] mr-2"></i>
                                    <h5 class="font-medium">${areaName}</h5>
                                </div>
                                <p class="text-sm text-gray-700">
                                    This executive order will impact ${areaName.toLowerCase()} at Yale University. 
                                </p>
                                ${areaDescription ? `<p class="text-xs text-gray-500 mt-2">${areaDescription}</p>` : ''}
                                ${areaNotes ? `<p class="text-xs italic text-gray-600 mt-2 border-t border-gray-100 pt-2">${areaNotes}</p>` : ''}
                            `;
                            
                            detailUniversityImpactAreas.appendChild(card);
                        });
                    } else {
                        detailUniversityImpactAreas.innerHTML = '<p class="text-gray-500">No specific university impact areas identified for this executive order.</p>';
                    }
                    
                    // Set URL
                    detailUrl.href = order.url || '#';
                    
                    // Reset active tab to summary
                    document.querySelectorAll('.tab-button').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('[data-tab="summary"]').classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                    document.getElementById('summary-tab').classList.remove('hidden');
                    
                    // Fetch plain language summary if available
                    if (order.has_plain_language_summary) {
                        fetchPlainLanguageSummary(order.id);
                    }
                    
                    // Show detail view
                    detailView.classList.remove('hidden');
                    
                    // Set focus to the close button for accessibility
                    setTimeout(() => {
                        closeDetailBtn.focus();
                    }, 100);
                    
                } catch (error) {
                    console.error('Error displaying order details:', error);
                    showToast('Error', 'Failed to load order details', 'error');
                }
            }
            
            // Toast notification function
            function showToast(title, message, type = 'info') {
                // Create toast container if it doesn't exist
                let toastContainer = document.getElementById('toast-container');
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.id = 'toast-container';
                    toastContainer.className = 'fixed bottom-4 right-4 z-50 flex flex-col gap-2';
                    document.body.appendChild(toastContainer);
                }
                
                // Create toast element
                const toast = document.createElement('div');
                toast.className = 'card p-4 shadow-lg flex items-start gap-3 animate-fade-in max-w-md';
                
                // Set background based on type
                const bgColor = type === 'success' ? 'bg-green-50 border-l-4 border-green-500' :
                                type === 'error' ? 'bg-red-50 border-l-4 border-red-500' :
                                'bg-blue-50 border-l-4 border-blue-500';
                toast.classList.add(...bgColor.split(' '));
                
                // Icon based on type
                const icon = type === 'success' ? '<i class="fas fa-check-circle text-green-500"></i>' :
                            type === 'error' ? '<i class="fas fa-exclamation-circle text-red-500"></i>' :
                            '<i class="fas fa-info-circle text-blue-500"></i>';
                
                toast.innerHTML = `
                    <div class="text-xl">
                        ${icon}
                    </div>
                    <div class="flex-1">
                        <h3 class="font-medium">${title}</h3>
                        <p class="text-sm text-gray-600">${message}</p>
                    </div>
                    <button class="text-gray-400 hover:text-gray-600 text-lg close-toast">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                // Add toast to container
                toastContainer.appendChild(toast);
                
                // Close button event
                toast.querySelector('.close-toast').addEventListener('click', () => {
                    toast.classList.add('opacity-0');
                    setTimeout(() => toast.remove(), 300);
                });
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.classList.add('opacity-0');
                        setTimeout(() => toast.remove(), 300);
                    }
                }, 5000);
            }
            
            // Add event listeners for filters
            searchInput.addEventListener('input', renderExecutiveOrdersTable);
            filterCategory.addEventListener('change', renderExecutiveOrdersTable);
            filterImpactLevel.addEventListener('change', renderExecutiveOrdersTable);
            filterUniversityArea.addEventListener('change', renderExecutiveOrdersTable);
            
            // Clear filters button
            clearFiltersBtn.addEventListener('click', () => {
                searchInput.value = '';
                filterCategory.value = '';
                filterImpactLevel.value = '';
                filterUniversityArea.value = '';
                renderExecutiveOrdersTable();
            });
            
            // Close detail view
            closeDetailBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                detailView.classList.add('hidden');
            });
            
            // Add event listeners for sorting
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', () => {
                    const field = th.dataset.sort;
                    
                    // Toggle sort direction or set to ascending if switching fields
                    if (field === sortField) {
                        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortField = field;
                        sortDirection = 'asc';
                    }
                    
                    // Update UI to indicate sort direction
                    document.querySelectorAll('th[data-sort]').forEach(header => {
                        const icon = header.querySelector('i');
                        if (icon) {
                            icon.className = 'fas fa-sort ml-1 text-gray-400';
                        }
                    });
                    
                    const icon = th.querySelector('i');
                    if (icon) {
                        icon.className = `fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} ml-1 text-blue-700`;
                    }
                    
                    // Re-render table
                    renderExecutiveOrdersTable();
                });
            });
            
            // Close detail view when clicking outside the modal
            detailView.addEventListener('click', (event) => {
                if (event.target === detailView) {
                    detailView.classList.add('hidden');
                }
            });
            
            // Close modal with escape key
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && !detailView.classList.contains('hidden')) {
                    detailView.classList.add('hidden');
                }
            });
            
            // URL-based routing
            function handleUrlNavigation() {
                const urlParams = new URLSearchParams(window.location.search);
                const orderId = urlParams.get('order');
                
                if (orderId) {
                    // Attempt to open the specified order
                    viewOrderDetails(orderId);
                }
            }
            
            // Update URL when viewing details
            function updateUrl(orderId) {
                const url = new URL(window.location);
                if (orderId) {
                    url.searchParams.set('order', orderId);
                } else {
                    url.searchParams.delete('order');
                }
                window.history.pushState({}, '', url);
            }
            
            // Add event listener for popstate (back/forward button)
            window.addEventListener('popstate', handleUrlNavigation);
            
            // Initialize
            async function init() {
                await getSystemInfo();
                await loadMetadata();
                await loadExecutiveOrders();
                handleUrlNavigation();
            }
            
            init();
        });
    </script>
</body>
</html>