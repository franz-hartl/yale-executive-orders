<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yale Executive Orders - MCP Client (Standalone)</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    
    header {
      margin-bottom: 30px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }
    
    h1 {
      color: #00356B; /* Yale Blue */
      margin-bottom: 10px;
    }
    
    .description {
      color: #666;
      font-size: 1.1em;
      margin-bottom: 20px;
    }
    
    .query-form {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .input-group {
      display: flex;
      margin-bottom: 15px;
    }
    
    #query-input {
      flex: 1;
      padding: 12px 15px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px 0 0 4px;
      outline: none;
    }
    
    #submit-query {
      background-color: #00356B;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 0 4px 4px 0;
      transition: background-color 0.2s;
    }
    
    #submit-query:hover {
      background-color: #002654;
    }
    
    #submit-query:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    .examples {
      margin-bottom: 30px;
      font-size: 0.9em;
    }
    
    .example-query {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 10px;
      background-color: #eef2f8;
      border: 1px solid #d2e2f7;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.9em;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .example-query:hover {
      background-color: #d2e2f7;
    }
    
    #result-container {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-height: 200px;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .error-message, .error-result {
      color: #d32f2f;
      padding: 15px;
      background-color: #ffebee;
      border-radius: 4px;
    }
    
    .success-result {
      padding: 10px 0;
    }
    
    .response-content {
      line-height: 1.7;
    }
    
    .credits {
      margin-top: 40px;
      font-size: 0.8em;
      color: #888;
      text-align: center;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }
    
    #loading-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: #00356B;
      animation: loading 1.5s infinite ease-in-out;
      display: none;
    }
    
    @keyframes loading {
      0% { width: 0; left: 0; }
      50% { width: 100%; left: 0; }
      100% { width: 0; left: 100%; }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      #query-input {
        border-radius: 4px;
        margin-bottom: 10px;
      }
      
      #submit-query {
        border-radius: 4px;
      }
    }
  </style>
</head>
<body>
  <div id="loading-indicator"></div>
  
  <header>
    <h1>Yale Executive Orders - MCP Client (Standalone)</h1>
    <div class="description">
      Ask questions about executive orders and their impact on Yale University and higher education. 
      This tool uses the Model Context Protocol (MCP) to provide relevant executive order context to Claude.
    </div>
  </header>
  
  <div class="query-form">
    <div class="input-group">
      <input type="text" id="query-input" placeholder="Ask a question about executive orders..." autocomplete="off">
      <button id="submit-query">Ask Claude</button>
    </div>
    
    <div class="examples">
      <p><strong>Try these examples:</strong></p>
      <div class="example-queries">
        <span class="example-query">What executive orders affect university research funding?</span>
        <span class="example-query">How do Biden's orders impact Yale?</span>
        <span class="example-query">Which orders have high impact on universities?</span>
        <span class="example-query">What are the compliance requirements for international students?</span>
      </div>
    </div>
  </div>
  
  <div id="result-container">
    <div class="loading">
      Ready to process your queries.
    </div>
  </div>
  
  <div class="credits">
    <p>Yale Executive Orders MCP Client &copy; 2025 | Powered by Claude</p>
  </div>
  
  <script>
    // Embedded sample data (3 executive orders)
    const SAMPLE_EXECUTIVE_ORDERS = [
      {
        "id": 1221,
        "order_number": "2025-03133",
        "title": "Commencing the Reduction of the Federal Bureaucracy",
        "signing_date": "2025-02-25",
        "president": "Trump",
        "summary": "This executive order aims to reduce the size of the federal bureaucracy by requiring agencies to identify unnecessary positions and functions, and to develop plans to streamline their operations. It also calls for a freeze on new hiring, with exceptions made only for roles deemed essential.",
        "full_text": "For universities like Yale, this order could lead to a reduction in federal funding and research grants, as well as the potential loss of key personnel who work in administrative and support roles. This could have a significant impact on university finances, requiring budget cuts and adjustments to maintain operations.",
        "impact_level": "High",
        "status": "Active",
        "implementation_phase": "Implementation",
        "categories": ["Technology"],
        "impact_areas": ["Policy", "Operational"],
        "university_impact_areas": [
          {
            "name": "Administrative Compliance",
            "description": "Compliance requirements, reporting mandates, and regulatory changes affecting university administration"
          }
        ],
        "yale_alert_level": "Low",
        "core_impact": "This executive order directly impacts Yale's research operations by requiring enhanced compliance measures."
      },
      {
        "id": 1222,
        "order_number": "2025-03134",
        "title": "Ensuring American Leadership in Artificial Intelligence",
        "signing_date": "2025-03-01",
        "president": "Trump",
        "summary": "This executive order establishes a national strategy for advancing artificial intelligence (AI) research, development, and deployment in the United States. It directs federal agencies to prioritize AI investments, reduce barriers to AI innovation, and develop guidance for AI regulation that protects American values and promotes trustworthy AI systems.",
        "full_text": "For universities, this order creates significant opportunities for research funding in AI fields while also introducing new compliance requirements for AI systems developed with federal funds. Yale and other research institutions will need to balance accelerated innovation with responsible AI development practices.",
        "impact_level": "High",
        "status": "Active",
        "implementation_phase": "Planning",
        "categories": ["Technology", "Research", "Education"],
        "impact_areas": ["Funding", "Policy", "Compliance"],
        "university_impact_areas": [
          {
            "name": "Research Funding",
            "description": "Impact on availability and requirements of research funding"
          },
          {
            "name": "Technology Transfer",
            "description": "Regulations and opportunities for commercializing university research"
          }
        ],
        "yale_alert_level": "Medium",
        "core_impact": "Creates significant opportunities for Yale's AI research initiatives while introducing new ethical guidelines and compliance requirements."
      },
      {
        "id": 1255,
        "order_number": "2025-05123",
        "title": "Promoting Excellence in Higher Education Research",
        "signing_date": "2025-04-15",
        "president": "Trump",
        "summary": "This executive order aims to enhance the quality and impact of federally-funded research at American universities. It establishes new accountability measures for research outcomes, promotes collaboration with industry partners, and creates incentives for universities to focus on areas of strategic national importance.",
        "full_text": "The order requires universities receiving federal research funding to implement enhanced reporting on research outcomes, including metrics for technology transfer, commercial applications, and economic impact. It also directs funding agencies to prioritize grants that align with national priorities in areas like quantum computing, advanced manufacturing, and biotechnology.",
        "impact_level": "Critical",
        "status": "Active",
        "implementation_phase": "Planning",
        "categories": ["Education", "Research", "Innovation"],
        "impact_areas": ["Funding", "Policy", "Compliance", "Partnerships"],
        "university_impact_areas": [
          {
            "name": "Research Funding",
            "description": "Impact on availability and requirements of research funding"
          },
          {
            "name": "Research Administration",
            "description": "Changes to management and oversight of research activities"
          },
          {
            "name": "Technology Transfer",
            "description": "Regulations and opportunities for commercializing university research"
          }
        ],
        "yale_alert_level": "High",
        "core_impact": "Fundamentally changes how Yale must prioritize, administer, and report on federally-funded research projects."
      }
    ];

    // Sample categories and impact areas
    const SAMPLE_CATEGORIES = [
      { "id": 1, "name": "Technology", "description": "Technology-related policies and regulations" },
      { "id": 2, "name": "Research", "description": "Research funding, oversight, and regulations" },
      { "id": 3, "name": "Education", "description": "Higher education policies and regulations" },
      { "id": 4, "name": "Innovation", "description": "Innovation promotion and technology transfer" }
    ];

    const SAMPLE_IMPACT_AREAS = [
      { "id": 1, "name": "Funding", "description": "Impacts on funding sources and requirements" },
      { "id": 2, "name": "Policy", "description": "Policy changes and regulatory requirements" },
      { "id": 3, "name": "Operational", "description": "Impacts on university operations" },
      { "id": 4, "name": "Compliance", "description": "New compliance requirements" },
      { "id": 5, "name": "Partnerships", "description": "Impacts on external partnerships and collaborations" }
    ];

    const SAMPLE_UNIVERSITY_IMPACT_AREAS = [
      { "id": 1, "name": "Research Funding", "description": "Impact on availability and requirements of research funding" },
      { "id": 2, "name": "Administrative Compliance", "description": "Compliance requirements, reporting mandates, and regulatory changes affecting university administration" },
      { "id": 3, "name": "Technology Transfer", "description": "Regulations and opportunities for commercializing university research" },
      { "id": 4, "name": "Research Administration", "description": "Changes to management and oversight of research activities" }
    ];

    // Cache for data
    const dataCache = {
      executiveOrders: SAMPLE_EXECUTIVE_ORDERS,
      categories: SAMPLE_CATEGORIES,
      impactAreas: SAMPLE_IMPACT_AREAS,
      universityImpactAreas: SAMPLE_UNIVERSITY_IMPACT_AREAS
    };

    // Load API key
    function getApiKey() {
      // Try getting from window global
      if (window.ANTHROPIC_API_KEY) {
        return window.ANTHROPIC_API_KEY;
      }
      
      // Or try session storage
      const storedKey = sessionStorage.getItem('ANTHROPIC_API_KEY');
      if (storedKey) {
        return storedKey;
      }
      
      // Or prompt the user
      const apiKey = prompt('Please enter your Anthropic API key (from console.anthropic.com):', '');
      if (apiKey) {
        // Store temporarily in session
        sessionStorage.setItem('ANTHROPIC_API_KEY', apiKey);
        return apiKey;
      }
      
      return null;
    }

    /**
     * Extract search terms from the user query
     */
    function extractSearchTerms(userQuery) {
      const stopWords = ['a', 'an', 'the', 'is', 'are', 'was', 'were', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'with', 'about', 'by'];
      
      return userQuery
        .toLowerCase()
        .replace(/[^\w\s]/g, '') // Remove punctuation
        .split(/\s+/) // Split on whitespace
        .filter(word => word.length > 2 && !stopWords.includes(word)) // Remove stop words and short words
        .slice(0, 5); // Take up to 5 terms
    }

    /**
     * Search executive orders based on query and filters
     */
    function searchExecutiveOrders(query) {
      // Convert query to lowercase for case-insensitive search
      const searchTerms = extractSearchTerms(query);
      
      return dataCache.executiveOrders.filter(order => {
        // Check search terms
        if (searchTerms.length > 0) {
          const searchableText = [
            order.title,
            order.summary,
            order.full_text,
          ].filter(Boolean).join(' ').toLowerCase();
          
          const matchesSearch = searchTerms.some(term => searchableText.includes(term));
          return matchesSearch;
        }
        
        return true;
      });
    }

    /**
     * Format the executive orders as context for the LLM
     */
    function formatOrdersAsContext(orders) {
      if (!orders || orders.length === 0) {
        return '';
      }
      
      let context = '### RELEVANT EXECUTIVE ORDERS ###\n\n';
      
      orders.forEach((order, index) => {
        context += `EXECUTIVE ORDER ${index + 1}:\n`;
        context += `Order Number: ${order.order_number}\n`;
        context += `Title: ${order.title}\n`;
        context += `Signing Date: ${order.signing_date}\n`;
        context += `President: ${order.president}\n`;
        context += `Impact Level: ${order.impact_level}\n`;
        
        if (order.summary) {
          context += `Summary: ${order.summary}\n`;
        }
        
        if (order.categories && order.categories.length > 0) {
          context += `Categories: ${order.categories.join(', ')}\n`;
        }
        
        if (order.impact_areas && order.impact_areas.length > 0) {
          context += `Impact Areas: ${order.impact_areas.join(', ')}\n`;
        }
        
        if (order.university_impact_areas && order.university_impact_areas.length > 0) {
          const uiaNames = order.university_impact_areas.map(area => 
            typeof area === 'string' ? area : area.name
          );
          context += `University Impact Areas: ${uiaNames.join(', ')}\n`;
        }
        
        if (order.yale_alert_level) {
          context += `Yale Alert Level: ${order.yale_alert_level}\n`;
        }
        
        if (order.core_impact) {
          context += `Core Impact: ${order.core_impact}\n`;
        }
        
        context += '\n';
      });
      
      return context;
    }

    /**
     * Process a user query and get a response from Claude
     */
    async function processUserQuery(userQuery) {
      try {
        // Extract search terms from the user query
        const searchTerms = extractSearchTerms(userQuery);
        console.log(`Extracted search terms: ${searchTerms.join(', ')}`);
        
        // Get relevant executive orders
        const relevantOrders = searchExecutiveOrders(userQuery);
        
        // Sort by most relevant and take top 3
        const scoredOrders = relevantOrders.map(order => {
          const text = [order.title, order.summary, order.full_text].filter(Boolean).join(' ').toLowerCase();
          let score = 0;
          searchTerms.forEach(term => {
            const regex = new RegExp(term, 'gi');
            const matches = text.match(regex) || [];
            score += matches.length;
          });
          return { ...order, relevanceScore: score };
        });
        
        // Sort by score and take top 3
        const topOrders = scoredOrders
          .sort((a, b) => b.relevanceScore - a.relevanceScore)
          .slice(0, 3);
        
        console.log(`Found ${relevantOrders.length} relevant executive orders, using top ${topOrders.length}`);
        
        if (topOrders.length === 0) {
          return {
            success: false,
            message: "No relevant executive orders found in our sample data. Please try a different query or check back later when we have a more comprehensive dataset."
          };
        }
        
        // Format the executive orders as context for the LLM
        const formattedContext = formatOrdersAsContext(topOrders);
        
        // Get API key
        const apiKey = getApiKey();
        if (!apiKey) {
          return { 
            success: false, 
            message: "API key is required to query Claude. You can get an API key from <a href='https://console.anthropic.com/' target='_blank'>console.anthropic.com</a>. When you return to this page, you'll be prompted to enter your key."
          };
        }
        
        // Prepare prompt for Claude
        const prompt = `
You are a university policy expert specializing in executive orders and their impact on higher education institutions.

${formattedContext}

Based on the executive orders information above, please answer the following question thoroughly:

${userQuery}

If the information provided does not contain an answer to the question, please say so and explain what additional information would be needed.
`;

        // Call the Anthropic API
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': apiKey,
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model: 'claude-3-sonnet-20240229',
            max_tokens: 1000,
            messages: [
              { role: 'user', content: prompt }
            ]
          })
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Anthropic API error: ${response.status} - ${errorText}`);
        }
        
        const responseData = await response.json();
        
        // Extract the assistant's response
        if (responseData && responseData.content && responseData.content.length > 0) {
          return {
            success: true,
            message: responseData.content[0].text,
            usedContext: formattedContext,
            searchTerms: searchTerms,
            ordersFound: topOrders.length
          };
        } else {
          return {
            success: false,
            message: 'Error: Unable to get a response from Claude.'
          };
        }
      } catch (error) {
        console.error('Error processing query:', error.message);
        return {
          success: false,
          message: `Error: ${error.message}`
        };
      }
    }

    // Initialize the MCP client when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Check if we have the necessary DOM elements
      const queryInput = document.getElementById('query-input');
      const submitButton = document.getElementById('submit-query');
      const resultContainer = document.getElementById('result-container');
      const loadingIndicator = document.getElementById('loading-indicator');
      
      if (!queryInput || !submitButton || !resultContainer) {
        console.error('Required DOM elements not found');
        return;
      }
      
      // Handle form submission
      submitButton.addEventListener('click', async () => {
        const query = queryInput.value.trim();
        if (!query) {
          return;
        }
        
        // Show loading indicator
        if (loadingIndicator) {
          loadingIndicator.style.display = 'block';
        }
        
        // Clear previous results
        resultContainer.innerHTML = '<div class="loading">Processing your query...</div>';
        
        // Process the query
        const result = await processUserQuery(query);
        
        // Hide loading indicator
        if (loadingIndicator) {
          loadingIndicator.style.display = 'none';
        }
        
        // Display the result
        if (result.success) {
          resultContainer.innerHTML = `
            <div class="success-result">
              <div class="claude-response">
                <h3>Claude's Response:</h3>
                <div class="response-content">${result.message.replace(/\n/g, '<br>')}</div>
              </div>
              
              <div class="context-details" style="margin-top: 20px; font-size: 0.9em; color: #666;">
                <p>Found ${result.ordersFound} relevant executive orders using search terms: ${result.searchTerms.join(', ')}</p>
                <details>
                  <summary>View Context Used</summary>
                  <pre style="background-color: #f5f5f5; padding: 10px; overflow: auto; max-height: 300px;">${result.usedContext}</pre>
                </details>
              </div>
            </div>
          `;
        } else {
          resultContainer.innerHTML = `
            <div class="error-result">
              <h3>Error</h3>
              <p>${result.message}</p>
            </div>
          `;
        }
      });
      
      // Allow Enter key to submit
      queryInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          submitButton.click();
        }
      });
      
      // Handle example queries
      document.querySelectorAll('.example-query').forEach(example => {
        example.addEventListener('click', () => {
          queryInput.value = example.textContent;
          submitButton.click();
        });
      });
      
      // Display ready status
      resultContainer.innerHTML = `
        <div class="loading">
          <p>Ready! This standalone demo includes 3 sample executive orders.</p>
          <p>Ask a question or click one of the example queries above to get started.</p>
        </div>
      `;
    });
  </script>
</body>
</html>