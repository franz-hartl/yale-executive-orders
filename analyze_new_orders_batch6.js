/**
 * analyze_new_orders_batch6.js
 * 
 * Sixth batch of analyses for executive orders without impact levels.
 */

const sqlite3 = require('sqlite3').verbose();
const path = require('path');
const fs = require('fs');
require('dotenv').config();

// Database connection
const dbPath = path.join(__dirname, 'executive_orders.db');
const db = new sqlite3.Database(dbPath);

// Promisify database operations
function dbRun(sql, params = []) {
  return new Promise((resolve, reject) => {
    db.run(sql, params, function(err) {
      if (err) reject(err);
      else resolve(this);
    });
  });
}

function dbGet(sql, params = []) {
  return new Promise((resolve, reject) => {
    db.get(sql, params, (err, row) => {
      if (err) reject(err);
      else resolve(row);
    });
  });
}

function dbAll(sql, params = []) {
  return new Promise((resolve, reject) => {
    db.all(sql, params, (err, rows) => {
      if (err) reject(err);
      else resolve(rows);
    });
  });
}

// Function to update order with manually defined analysis
async function updateOrderWithAnalysis(orderId, analysis) {
  try {
    console.log(`Updating order ${orderId} with analysis results`);
    
    // Update the executive order with summary and impact level
    await dbRun(
      `UPDATE executive_orders 
       SET summary = ?, 
           impact_level = ?, 
           plain_language_summary = ?,
           executive_brief = ?,
           comprehensive_analysis = ?
       WHERE id = ?`,
      [
        analysis.summary,
        analysis.impactLevel,
        analysis.summary,
        analysis.executiveBrief,
        analysis.comprehensiveAnalysis,
        orderId
      ]
    );
    
    // Update categories
    for (const categoryName of analysis.categories) {
      // Get category ID
      const category = await dbGet('SELECT id FROM categories WHERE name = ?', [categoryName]);
      if (category) {
        // Check if relation already exists
        const existingRelation = await dbGet(
          'SELECT * FROM order_categories WHERE order_id = ? AND category_id = ?',
          [orderId, category.id]
        );
        
        if (!existingRelation) {
          // Add category relation
          await dbRun(
            'INSERT INTO order_categories (order_id, category_id) VALUES (?, ?)',
            [orderId, category.id]
          );
          console.log(`Added category ${categoryName} to order ${orderId}`);
        }
      } else {
        console.log(`Category not found: ${categoryName}`);
      }
    }
    
    // Update university impact areas
    for (const areaName of analysis.universityImpactAreas) {
      // Get impact area ID
      const area = await dbGet('SELECT id FROM university_impact_areas WHERE name = ?', [areaName]);
      if (area) {
        // Check if relation already exists
        const existingRelation = await dbGet(
          'SELECT * FROM order_university_impact_areas WHERE order_id = ? AND university_impact_area_id = ?',
          [orderId, area.id]
        );
        
        if (!existingRelation) {
          // Add impact area relation
          await dbRun(
            'INSERT INTO order_university_impact_areas (order_id, university_impact_area_id) VALUES (?, ?)',
            [orderId, area.id]
          );
          console.log(`Added university impact area ${areaName} to order ${orderId}`);
        }
      } else {
        console.log(`University impact area not found: ${areaName}`);
      }
    }
    
    console.log(`Successfully updated order ${orderId} with analysis results`);
    return true;
  } catch (error) {
    console.error(`Error updating order ${orderId} with analysis:`, error);
    return false;
  }
}

// Main function
async function main() {
  try {
    console.log("Starting analysis of executive orders without impact levels (Batch 6)...");
    
    // Get orders that need analysis (those without impact levels)
    const ordersToAnalyze = await dbAll(`
      SELECT id, order_number, title, signing_date, publication_date, president, summary, full_text, url
      FROM executive_orders 
      WHERE impact_level IS NULL OR impact_level = ''
      ORDER BY signing_date DESC
      LIMIT 6
    `);
    
    console.log(`Found ${ordersToAnalyze.length} orders that still need analysis`);
    
    // Print orders that need analysis
    for (const order of ordersToAnalyze) {
      console.log(`${order.order_number}: ${order.title}`);
    }
    
    // Process orders with manual analysis - batch 6
    const batchAnalysis = [
      {
        order_number: "2025-02091",
        title: "Reevaluating and Realigning United States Foreign Aid",
        analysis: {
          summary: "This executive order reevaluates and realigns U.S. foreign aid, potentially impacting Yale's international programs, research partnerships, and foreign student support. The university should prepare for changes in federal funding for international initiatives and potential visa complications for students from affected countries.",
          executiveBrief: "President Trump's executive order reevaluating U.S. foreign aid will have significant implications for Yale University's international programs and partnerships. This order mandates a comprehensive review of all U.S. foreign assistance with the goal of redirecting aid toward countries that align with American interests, potentially affecting Yale's global research collaborations and international student programs.\n\nWith extensive international partnerships in regions that may see aid reductions, Yale should anticipate disruptions to federally-funded global initiatives, particularly those in regions identified for aid reduction. The Jackson School of Global Affairs, Yale School of Public Health, and other units with significant international programming should prepare for potential funding shifts affecting research collaborations, field programs, and exchange initiatives.\n\nFinancially, Yale should evaluate its current international programs for exposure to changing federal priorities, identify alternative funding sources for critical projects in potentially affected regions, and develop contingency plans for programs heavily dependent on federal international assistance funding. While the direct university budget impact may be limited to specific programs, broader implications for Yale's international strategy and global positioning should be carefully considered.",
          comprehensiveAnalysis: "Executive Order 2025-02091, \"Reevaluating and Realigning United States Foreign Aid,\" initiates a comprehensive review of U.S. foreign assistance programs with the goal of redirecting aid toward countries that align with American interests and away from those deemed contrary to U.S. priorities. This policy shift will have multifaceted implications for Yale University's international engagement, research partnerships, and educational programs.\n\nIMPACT ON INTERNATIONAL RESEARCH PARTNERSHIPS:\nYale maintains extensive research partnerships in regions that may experience significant changes in U.S. foreign assistance:\n\n1. Global Health Initiatives: Yale School of Public Health operates numerous research programs in developing nations that often leverage USAID funding or operate in environments supported by U.S. foreign assistance. Programs like the Yale Global Health Leadership Initiative, which works in Ethiopia, Rwanda, and other nations, may face changing funding landscapes or partner capacity challenges.\n\n2. Environmental Research: Yale School of the Environment conducts field research in tropical forests, conservation areas, and climate-vulnerable regions worldwide. Many of these projects operate in countries where U.S. foreign aid supports environmental governance, creating potential indirect impacts on research infrastructure.\n\n3. Social Science Research: Faculty across multiple departments conduct field research in developing nations on topics ranging from economic development to political institutions. Changing aid priorities may affect the operational context for this research.\n\nEstimated research activities potentially affected: Approximately $15-25 million in active research projects involve international collaborations in regions that could experience significant foreign aid adjustments.\n\nIMPLICATIONS FOR EDUCATIONAL PROGRAMS:\nYale's educational programs with international dimensions may face several challenges:\n\n1. Study Abroad Programs: Yale operates study abroad programs in approximately 50 countries, some of which may face changing security or operational environments if U.S. foreign assistance shifts significantly. Programs in regions experiencing reduced aid may require enhanced risk assessment and contingency planning.\n\n2. International Student Mobility: Changes in bilateral relationships resulting from aid realignment could complicate visa processing or create political tensions affecting student mobility. Yale enrolls approximately 3,000 international students annually, some from countries potentially affected by aid realignment.\n\n3. Fellowship Programs: Programs like the Fox International Fellowship, which facilitates exchange with 20 partner universities worldwide, may face challenges if partner institutions in affected countries experience funding constraints or changing political environments.\n\nFINANCIAL CONSIDERATIONS:\nThe financial impact on Yale's operations will manifest through several channels:\n\n1. Direct Federal Funding: Yale receives approximately $5-10 million annually for international programs through agencies like USAID, the State Department, and other entities involved in foreign assistance. This funding could face reprioritization or redirection.\n\n2. Partner Institution Capacity: Many of Yale's international partners receive U.S. foreign assistance that supports their research infrastructure, faculty capacity, and operational capabilities. Reduced aid could affect their ability to maintain productive collaborations with Yale.\n\n3. Compliance Costs: Yale may face increased compliance requirements for programs in countries with changing aid relationships, potentially increasing administrative burdens and costs.\n\n4. Currency and Economic Impacts: Countries experiencing significant reductions in U.S. foreign aid may face economic challenges that complicate Yale's financial operations in those regions, potentially affecting program budgets and financial management.\n\nSTRATEGIC IMPLICATIONS FOR YALE'S SCHOOLS:\n\n1. Jackson School of Global Affairs: As Yale's newest professional school focused on global leadership, the Jackson School may need to adjust research priorities, student placement opportunities, and curriculum to reflect changing global aid landscapes. The school's emphasis on evidence-based policymaking positions it to analyze and respond to these shifts.\n\n2. Yale Law School: The law school's international human rights work, which often intersects with development assistance, may face changing contexts in regions experiencing aid reductions. Programs like the Schell Center for International Human Rights may need to adapt strategies for fieldwork and partnerships.\n\n3. Yale School of Management: The school's global business programs and social enterprise initiatives often operate in developing economies that benefit from U.S. assistance. Changing aid priorities may affect the operational context for these educational and research activities.\n\nADAPTATION STRATEGIES:\nYale can take several approaches to navigate this changing landscape:\n\n1. Risk Assessment: Develop a comprehensive assessment of Yale programs potentially affected by changing aid priorities, identifying those most vulnerable to disruption.\n\n2. Funding Diversification: Accelerate efforts to diversify funding sources for international programs, potentially exploring foundation grants, corporate partnerships, or alumni support targeted at maintaining critical international engagements.\n\n3. Partnership Rebalancing: Evaluate the geographic distribution of Yale's international partnerships, potentially expanding collaborations in regions expected to receive stable or increased U.S. support.\n\n4. Policy Engagement: Leverage Yale's expertise in global affairs to participate in policy discussions about effective foreign assistance, potentially influencing how the aid reevaluation proceeds in areas critical to academic engagement.\n\nThis executive order represents a Medium impact on Yale University operations, primarily affecting Research Funding and Administrative Compliance dimensions. The university's international strategy will require thoughtful recalibration to navigate changing federal priorities while maintaining Yale's global leadership position in research and education.",
          impactLevel: "Medium",
          categories: ["Education", "Finance"],
          universityImpactAreas: ["Research Funding", "Administrative Compliance"]
        }
      },
      {
        order_number: "2025-02090",
        title: "Defending Women From Gender Ideology Extremism and Restoring Biological Truth to the Federal Government",
        analysis: {
          summary: "This executive order affects Yale's policies regarding gender identity, potentially impacting anti-discrimination protocols, athletic programs, student housing, and healthcare services. Yale will need to thoroughly review its policies while balancing compliance with federal requirements and its commitment to inclusive educational environments.",
          executiveBrief: "The executive order 'Defending Women From Gender Ideology Extremism and Restoring Biological Truth to the Federal Government' has significant implications for Yale University's policies regarding gender identity, with potential impacts across multiple operational areas. This order directs federal agencies to adopt definitions of 'sex' based on biological characteristics, which may affect how federal regulations and funding requirements apply to university programs.\n\nYale will need to carefully evaluate its current policies on student housing assignments, bathroom and locker room access, athletic program participation, and healthcare services to identify potential compliance issues. The university's Office of General Counsel should lead a comprehensive review of relevant policies in coordination with the Office for Institutional Equity and Accessibility, athletics departments, and residential life administrators.\n\nFinancially, Yale may face increased costs related to policy review, potential facility modifications, and possible litigation risks. The university will need to develop a nuanced approach that balances compliance with federal requirements, state laws, institutional values, and commitments to providing inclusive educational environments. Clear communication with the university community about any policy adjustments will be essential to managing this transition effectively.",
          comprehensiveAnalysis: "Executive Order 2025-02090, \"Defending Women From Gender Ideology Extremism and Restoring Biological Truth to the Federal Government,\" mandates federal agencies to adopt definitions of \"sex\" based on biological characteristics rather than gender identity. This directive represents a significant shift in federal policy with wide-ranging implications for Yale University's operations, policies, and compliance obligations.\n\nPOLICY AND COMPLIANCE IMPLICATIONS:\nYale's extensive non-discrimination policies and transgender-inclusive practices may require substantial review and potential modification:\n\n1. Title IX Compliance: Yale's current Title IX implementation includes protections based on gender identity. The executive order potentially narrows the interpretation of sex discrimination under Title IX, requiring Yale to evaluate its non-discrimination protocols, complaint procedures, and training materials. This affects the university's Office for Institutional Equity and Accessibility, which handles approximately 300-400 consultations annually on issues related to sex and gender.\n\n2. Admissions Policies: While Yale College is already co-educational, graduate and professional programs that consider gender in admissions decisions (such as programs designed to increase women's representation in STEM fields) may need to review their practices to ensure compliance with new federal interpretations.\n\n3. Student Life Policies: Yale's current policies allowing students to live in housing consistent with their gender identity, use facilities aligned with their gender identity, and have their chosen names and pronouns recognized in university systems may require reconsideration based on new federal guidelines.\n\nFACILITIES AND SERVICES IMPACT:\nThe executive order potentially affects how Yale manages various spaces and services:\n\n1. Housing Assignments: Yale houses approximately 6,500 students in campus housing. Current policies allowing transgender students to access housing consistent with their gender identity may need reevaluation. Any changes could impact housing assignment processes, residential life staff training, and student experience.\n\n2. Bathrooms and Locker Rooms: Yale has invested in creating gender-inclusive restrooms across campus over the past decade. The executive order may influence future facility planning and potentially affect access policies for existing facilities.\n\n3. Athletic Programs: Yale sponsors 35 varsity athletic teams and numerous club and intramural programs. Current NCAA and Ivy League policies on transgender athlete participation may conflict with new federal guidance, creating compliance challenges for Yale's athletic department.\n\nHEALTHCARE SERVICES CONSIDERATIONS:\nYale's health services and insurance provisions face potential challenges:\n\n1. Yale Health Services: The university health service provides care to approximately 37,000 students, faculty, staff, and dependents. Current protocols for transgender healthcare, including hormone therapy and mental health support, may require review based on new federal guidelines.\n\n2. Health Insurance Coverage: Yale's employee and student health insurance plans currently include coverage for transgender-related healthcare. Changes in federal definitions may impact insurance requirements and coverage determinations.\n\n3. Medical Education: Yale School of Medicine trains future physicians in providing inclusive care across gender identities. Curriculum and clinical training approaches may need review to balance federal compliance with professional medical standards.\n\nFINANCIAL IMPLICATIONS:\nThe financial impact will manifest through several channels:\n\n1. Compliance Review Costs: Comprehensive policy review and potential revisions across the university will require significant administrative resources, estimated at $150,000-$300,000 in staff time and legal consultation.\n\n2. Potential Facility Modifications: If Yale needs to modify facilities to align with new federal expectations while still meeting community needs, costs could range from minimal signage changes to substantial construction projects.\n\n3. Litigation Risk: Yale faces potential legal challenges regardless of its approach—either from individuals affected by policy changes or from regulatory non-compliance complaints if policies remain unchanged.\n\n4. Federal Funding Considerations: Yale receives approximately $500-700 million annually in federal funding across research, financial aid, and other programs. Ensuring compliance while minimizing disruption to these funding streams will be critical.\n\nCOMMUNITY IMPACT MANAGEMENT:\nYale must navigate complex stakeholder dynamics:\n\n1. Student Experience: Yale's diverse student body includes transgender and non-binary students who may experience significant personal impacts from policy changes. Maintaining educational access and psychological safety for all students will require careful planning.\n\n2. Faculty and Staff Concerns: Yale employs approximately 14,000 faculty and staff, including transgender employees who may be affected by changing policies related to benefits, facilities access, and workplace protections.\n\n3. Institutional Values Tension: Yale has articulated commitments to diversity, equity, and inclusion that may conflict with narrow biological definitions of sex. Navigating this tension while maintaining legal compliance presents significant challenges for university leadership.\n\nSTRATEGIC RESPONSE OPTIONS:\nYale has several potential approaches:\n\n1. Minimal Compliance Strategy: Identify specific federal requirements that directly affect federal funding and adjust only those policies necessary to maintain compliance, while preserving inclusive practices where possible.\n\n2. Differentiated Policy Framework: Develop nuanced policies that may vary based on funding source, with programs receiving significant federal funding adopting approaches consistent with new definitions, while maintaining more inclusive practices in other areas.\n\n3. State Law Alignment: Connecticut state law provides protections based on gender identity. Yale could evaluate placing greater emphasis on state law compliance where federal and state requirements diverge.\n\n4. Legal Challenge Participation: Yale could consider joining other institutions in seeking clarity on the application of the executive order to higher education, particularly private institutions.\n\nThis executive order represents a High impact on Yale University operations, primarily affecting Administrative Compliance and Workforce & Employment Policy areas. The university faces complex challenges in balancing federal compliance with institutional values, state laws, and commitments to inclusive education. Substantial administrative resources will be required to navigate this changing regulatory landscape effectively.",
          impactLevel: "High",
          categories: ["Education", "Healthcare"],
          universityImpactAreas: ["Administrative Compliance", "Workforce & Employment Policy"]
        }
      },
      {
        order_number: "2025-02089",
        title: "Clarifying the Military's Role in Protecting the Territorial Integrity of the United States",
        analysis: {
          summary: "This executive order clarifies the military's role in border security, with limited direct impact on Yale's core operations. However, the university should monitor potential effects on international student mobility, research partnerships in border regions, and security-related research funding priorities.",
          executiveBrief: "President Trump's executive order clarifying the military's role in protecting U.S. territorial integrity primarily affects defense and border security operations, with limited direct impact on Yale University's core educational and research functions. However, several indirect effects warrant monitoring.\n\nYale enrolls approximately 3,000 international students annually, some of whom may experience enhanced scrutiny or processing delays at borders due to increased military involvement in border security. The Office of International Students and Scholars should monitor implementation of this order for any impacts on student and scholar mobility, particularly for individuals from regions identified as security priorities.\n\nFor research operations, Yale should monitor potential changes to security-related research funding priorities, as the order may signal increased federal investment in border security technologies, threat detection systems, and related defensive capabilities. Faculty in computer science, engineering, and other relevant fields may see new funding opportunities aligned with these priorities.\n\nOverall, while this order has minimal direct financial implications for Yale's budget, maintaining awareness of its implementation will help the university anticipate and respond to any secondary effects on international academic mobility and research priorities.",
          comprehensiveAnalysis: "Executive Order 2025-02089, \"Clarifying the Military's Role in Protecting the Territorial Integrity of the United States,\" expands and clarifies the Department of Defense's authorities and responsibilities regarding border security and territorial protection. While primarily focused on military operations and homeland security, this order has several implications for Yale University's international engagements, research priorities, and operational considerations.\n\nIMPLICATIONS FOR INTERNATIONAL STUDENT MOBILITY:\nYale maintains a significant international community that may be affected by enhanced border security measures:\n\n1. Student and Scholar Visa Processing: Yale enrolls approximately 3,000 international students and hosts hundreds of visiting scholars annually. Enhanced security protocols at borders may result in additional processing times or increased scrutiny for certain visa categories or nationalities. The Office of International Students and Scholars, which processes approximately 5,000 immigration documents annually, may need to adjust guidance and planning timelines.\n\n2. Entry Procedures: International students and scholars, particularly those from regions identified as security priorities, may experience enhanced screening or delays when entering the U.S. for academic terms or conferences. This could affect academic planning, orientation scheduling, and student experience.\n\n3. Cross-Border Programs: Yale operates several academic programs involving regular border crossings, such as collaborations with Canadian universities and field research in Mexico. These programs may experience logistical complications if border crossing protocols change significantly.\n\nRESEARCH IMPLICATIONS:\nThe executive order may influence research priorities and operational contexts:\n\n1. Security-Related Research Funding: The increased emphasis on territorial security may result in expanded federal funding for research related to border monitoring technologies, threat detection systems, and security operations. Yale's applied science departments and security studies programs may see new funding opportunities aligned with these priorities.\n\n2. Border Region Research: Yale faculty conduct research in U.S. border regions on topics ranging from environmental issues to migration patterns. Enhanced military presence in these areas may affect research access, methodologies, or community engagement approaches.\n\n3. Military-Academic Partnerships: The order may create new opportunities for research collaborations between Yale and military entities focused on territorial security challenges, potentially expanding engagement beyond Yale's existing relationships with defense research agencies.\n\nOPERATIONAL CONSIDERATIONS:\nSeveral operational dimensions warrant monitoring:\n\n1. Campus Security Planning: Yale's security operations maintain coordination with local, state, and federal authorities. The clarified military role in domestic security may result in updated guidance or protocols for university emergency management and coordination with external agencies.\n\n2. International Programs Risk Assessment: Yale's study abroad programs and international research initiatives undergo regular risk assessment. The order's implementation may require adjustments to how security environments are evaluated in certain regions, particularly those near international borders or in areas with increased military activity.\n\n3. Immigration Legal Services: Yale Law School's immigration legal clinics serve community members affected by immigration policies. Changes in border enforcement may increase demand for these services and create new legal questions for clinical faculty and students.\n\nFINANCIAL IMPLICATIONS:\nThe direct financial impact on Yale is expected to be minimal:\n\n1. Student Services Adjustments: Minor additional costs may be incurred in expanding support services for international students navigating enhanced security procedures, estimated at $25,000-$50,000 annually if dedicated resources are required.\n\n2. Research Opportunity Costs/Benefits: The net financial impact on research funding is difficult to predict, with potential new opportunities in security-related fields potentially offset by complications in other international research areas.\n\n3. Compliance Costs: Minimal additional costs may be associated with ensuring university operations remain compliant with evolving security protocols, primarily absorbed within existing administrative structures.\n\nSTRATEGIC CONSIDERATIONS:\n\n1. Monitoring Framework: Yale's Office of Federal Relations should establish a monitoring system to track implementation of this order and its practical effects on higher education operations, coordinating with national higher education associations to share information.\n\n2. Contingency Planning: For critical international programs, particularly those in border regions, developing contingency plans for potential disruptions would be prudent risk management.\n\n3. Stakeholder Communication: Developing clear communication protocols for international students and scholars regarding any changes to entry procedures will help manage expectations and reduce uncertainty.\n\n4. Research Positioning: Faculty with expertise relevant to border security technologies or policies may wish to consider how their research programs align with potentially shifting federal priorities.\n\nThis executive order represents a Low impact on Yale University operations, primarily affecting limited aspects of Administrative Compliance related to international programs. While not requiring immediate significant action, monitoring implementation details will help the university anticipate and respond to any secondary effects on international academic mobility and related operations.",
          impactLevel: "Low",
          categories: ["National Security"],
          universityImpactAreas: ["Administrative Compliance"]
        }
      },
      {
        order_number: "2025-02087",
        title: "Application of Protecting Americans From Foreign Adversary Controlled Applications Act to TikTok",
        analysis: {
          summary: "This executive order applies the Protecting Americans From Foreign Adversary Controlled Applications Act to TikTok, with implications for Yale's social media strategy and digital communications research. While primarily affecting institutional communications, it also impacts research in digital media, international relations, and data privacy areas.",
          executiveBrief: "President Trump's executive order applying the Protecting Americans From Foreign Adversary Controlled Applications Act to TikTok directly affects Yale University's digital communication strategy and presents considerations for academic research and teaching. Yale currently maintains institutional TikTok accounts with approximately 25,000 followers across several schools and departments, primarily used for student recruitment, community engagement, and institutional branding.\n\nYale's Office of Communications and relevant digital media teams should develop an immediate contingency plan for alternative platforms that can reach similar audiences. Admissions departments, which have increasingly relied on TikTok for student outreach, should particularly focus on developing alternative digital engagement strategies.\n\nBeyond communications impact, this order creates teaching implications for courses addressing social media, digital communications, and international technology policy, particularly in the School of Management, Department of Computer Science, and Jackson School of Global Affairs. Additionally, research projects analyzing TikTok data or comparing social media platforms may require methodological adjustments. While the direct financial impact is minimal, the strategic communications and academic implications require thoughtful planning and adaptation.",
          comprehensiveAnalysis: "Executive Order 2025-02087, \"Application of Protecting Americans From Foreign Adversary Controlled Applications Act to TikTok,\" formally restricts TikTok operations under national security grounds. This directive has multifaceted implications for Yale University across institutional communications, academic research, and teaching contexts.\n\nINSTITUTIONAL COMMUNICATIONS IMPACT:\nYale has established a significant social media presence across platforms, including TikTok:\n\n1. Current TikTok Presence: Yale maintains approximately 8-10 institutional TikTok accounts, including the main university account (@yale) with approximately 25,000 followers, and separate accounts for Yale Admissions, Yale Athletics, several professional schools, and student organizations. These accounts collectively post 100-150 videos per month during peak periods.\n\n2. Strategic Communication Loss: Yale's TikTok strategy has focused on reaching prospective students (particularly Gen Z audiences), highlighting campus life, research breakthroughs, and institutional culture. The platform's algorithm and demographic reach offered unique audience engagement that other platforms don't fully replicate.\n\n3. Digital Marketing Adjustments: Yale's Office of Communications and Public Affairs will need to reallocate approximately $50,000-75,000 in annual digital marketing resources previously directed toward TikTok content creation and promotion. This represents about 5-8% of Yale's social media marketing budget.\n\n4. Alternative Platform Strategy: Communications teams will need to develop enhanced strategies for Instagram Reels, YouTube Shorts, and other short-form video platforms to reach similar audiences, potentially requiring additional staff training and adjusted creative approaches.\n\nACADEMIC RESEARCH IMPLICATIONS:\nThe restriction affects several research domains at Yale:\n\n1. Social Media Research: Yale researchers in sociology, psychology, political science, and communication studies have used TikTok as a data source for studies on information spread, political communication, and youth culture. Approximately 15-20 active research projects may need methodological adjustments.\n\n2. Digital Privacy and Security Research: The Jackson Institute for Global Affairs and Yale Law School's Information Society Project conduct research on digital privacy, security, and platform governance. The TikTok restriction creates both challenges for existing research and new case study opportunities.\n\n3. International Relations Research: The executive order presents a case study for Yale researchers studying technology in international relations, digital sovereignty, and U.S.-China technology competition. Faculty in International Relations, East Asian Studies, and the Jackson School may need to update course materials and research frameworks.\n\n4. Data Access Concerns: Research projects that had negotiated TikTok data access may face disruption, potentially affecting publication timelines and grant deliverables for 5-10 research teams.\n\nTEACHING AND CURRICULUM IMPLICATIONS:\nThe restriction creates teaching considerations across multiple schools:\n\n1. Digital Marketing Courses: The School of Management and School of Art offer courses on digital marketing and social media strategy that include TikTok as a significant platform. Curriculum adjustments will be required for approximately 5-8 courses.\n\n2. Communication Studies: Courses addressing digital media trends, platform economics, and content creation will need to adjust syllabi and case studies. The restriction potentially affects 10-15 courses across the Faculty of Arts and Sciences.\n\n3. Computer Science and Data Science: Courses addressing recommendation algorithms, content moderation, and platform design often use TikTok as a contemporary case study. Faculty in approximately 3-5 courses will need to update teaching materials.\n\n4. Legal Education: Yale Law School courses on technology law, international trade law, and national security law will need to incorporate this case as a teaching example. The restriction affects content in approximately 5-7 courses.\n\nSTUDENT LIFE CONSIDERATIONS:\nThe restriction has implications for student activities and campus culture:\n\n1. Student Organizations: Approximately 30-40 student organizations use TikTok for promotion, event coverage, and community building. These groups will need support transitioning to alternative platforms.\n\n2. Campus Events: Several annual campus events have incorporated TikTok content creation, including orientation activities and student showcases. Event planning committees will need to develop alternative engagement strategies.\n\n3. International Student Concerns: Yale's significant international student population (approximately 3,000 students) includes many from countries where TikTok is a primary communication platform. These students may experience additional communication barriers with home communities.\n\nFINANCIAL AND OPERATIONAL IMPLICATIONS:\nThe direct financial impact is relatively contained:\n\n1. Content Migration Costs: Moving existing content to alternative platforms will require approximately 80-120 staff hours across departments, representing an opportunity cost of $5,000-7,500.\n\n2. Training Requirements: Staff responsible for digital communications will need training on alternative platforms and adjusted digital strategies, requiring approximately $10,000-15,000 in professional development resources.\n\n3. Potential Research Funding Implications: Research grants specifically studying TikTok may need scope adjustments, potentially affecting approximately $250,000-500,000 in active grant funding across the university.\n\nSTRATEGIC RESPONSE RECOMMENDATIONS:\n\n1. Platform Diversification: Communications teams should accelerate existing efforts to diversify social media presence across multiple platforms, reducing vulnerability to single-platform restrictions.\n\n2. Community Guidance: Develop clear guidance for Yale community members regarding compliance expectations, particularly for departments and student organizations.\n\n3. Research Adaptation Support: Provide targeted support for researchers whose work is directly affected, potentially including methodological consultations and support for IRB amendments.\n\n4. Teaching Resource Development: Create a faculty resource guide addressing how to teach about platform restrictions while maintaining educational quality and research integrity.\n\nThis executive order represents a Low impact on Yale University operations, primarily affecting Communications strategies and creating modest adjustments for certain Research areas. While not threatening core educational or research functions, it requires tactical adjustments across several university domains and merits coordinated response planning.",
          impactLevel: "Low",
          categories: ["Technology", "National Security"],
          universityImpactAreas: ["Administrative Compliance", "Research Funding"]
        }
      },
      {
        order_number: "2025-02015",
        title: "Securing Our Borders",
        analysis: {
          summary: "This executive order on border security affects Yale's international student recruitment, visa processing, and global academic partnerships. The university should prepare for increased visa processing times, enhanced vetting for certain nationalities, and potential impacts on international research collaborations.",
          executiveBrief: "President Trump's executive order on border security will have significant implications for Yale University's international student program, global research partnerships, and study abroad operations. While primarily focused on physical border security and immigration enforcement, the order contains provisions that will affect academic mobility and international academic operations.\n\nYale currently enrolls approximately 3,000 international students from over 120 countries, representing about 22% of the student body. The Office of International Students and Scholars should anticipate increased visa processing times, enhanced vetting procedures for students from certain countries, and potential complications for students with complex immigration histories. The university should prepare to provide additional support resources for affected students and develop contingency plans for delayed arrivals.\n\nFor Yale's global operations, including research partnerships in over 50 countries and study abroad programs, the order may complicate international travel for faculty and students, particularly for those conducting research in border regions or on migration-related topics. Yale's Office of International Affairs should review upcoming international programs for potential disruptions and develop appropriate risk mitigation strategies.\n\nFinancially, Yale should prepare for potential increased administrative costs related to immigration compliance, additional support services for international students navigating enhanced procedures, and possible enrollment fluctuations in programs with high international student participation.",
          comprehensiveAnalysis: "Executive Order 2025-02015, \"Securing Our Borders,\" implements comprehensive measures to enhance U.S. border security, immigration enforcement, and visa screening procedures. While focused primarily on border operations and immigration enforcement, this order has significant implications for Yale University's international student enrollment, global research partnerships, and international operations.\n\nINTERNATIONAL STUDENT RECRUITMENT AND RETENTION:\nYale's substantial international student community faces several potential impacts:\n\n1. Visa Processing Complications: Enhanced screening procedures mandated by the order will likely increase visa processing times and complexity, particularly for students from countries identified as security priorities. Yale's international student population includes significant cohorts from regions that may face enhanced scrutiny, potentially affecting 600-800 current and prospective students.\n\n2. Enrollment Uncertainty: Increased visa unpredictability may complicate yield management for admissions offices across Yale's schools. The university typically admits international students with a 35-40% yield expectation; increased visa uncertainties could reduce yields by 5-10 percentage points, requiring adjusted admission strategies.\n\n3. Student Experience Impacts: International students may face increased anxiety, travel complications, and barriers to family visits under enhanced border security protocols. Yale's mental health services and international student support offices should anticipate increased demand for assistance navigating these challenges.\n\n4. Optional Practical Training (OPT) Complications: Approximately 250-300 Yale international students and recent graduates participate in OPT annually. The executive order's provisions regarding work authorization verification may create additional hurdles for these students entering the U.S. workforce.\n\nGLOBAL RESEARCH AND ACADEMIC PARTNERSHIPS:\nYale's extensive international research enterprise faces several considerations:\n\n1. Research Mobility Challenges: Yale faculty conduct field research in approximately 80 countries, with particular concentration in Latin America, Africa, and Asia. Enhanced border security measures may complicate travel for research teams, particularly those working in border regions or on migration-related topics.\n\n2. Conference and Academic Exchange Impacts: Yale hosts approximately 30-40 international academic conferences annually and welcomes hundreds of international scholars for collaborative work. Visa complications for academic visitors could affect the university's ability to maintain its position as a global convening center.\n\n3. International Research Ethics: Research projects involving migration, border communities, or undocumented populations may face changing ethical and security considerations. Yale's Institutional Review Board may need to develop enhanced guidance for researchers working in these sensitive areas.\n\nSTUDY ABROAD AND INTERNATIONAL EDUCATION:\nYale's global education programs require strategic adaptation:\n\n1. Program Planning Uncertainty: Yale sends approximately a strong percentage of undergraduates on term-time or summer study abroad experiences. Programs in regions experiencing significant migration pressures or near enforced borders may require enhanced risk assessment and contingency planning.\n\n2. International Student Advising: Yale's Office of International Students and Scholars processes approximately 5,000 immigration documents annually. The order will likely increase this workload by 15-20% and require more complex individual consultations with students navigating the changing regulatory landscape.\n\n3. Re-entry Challenges: Students and faculty participating in international programs, particularly those from countries affected by enhanced screening, may face complications when returning to the U.S. after international study or research. Program calendars may need adjustment to accommodate longer processing times.\n\nFINANCIAL IMPLICATIONS:\nThe executive order creates several financial considerations for Yale:\n\n1. Administrative Compliance Costs: Yale will likely need to expand staffing and resources in international student services, immigration compliance, and legal support to manage increased regulatory complexity. Estimated additional costs range from $200,000-$400,000 annually.\n\n2. Potential Enrollment Impacts: If international student enrollment decreases due to visa barriers, certain graduate and professional programs with high international student percentages could face revenue implications. For example, some STEM and business programs have international student populations exceeding 40%.\n\n3. Risk Management Expenses: Enhanced due diligence for international programs, insurance considerations, and contingency planning will generate additional administrative costs estimated at $75,000-$150,000 annually.\n\n4. Opportunity Costs: Faculty and administrators will devote significant time to navigating new regulatory requirements, potentially reducing time available for core academic activities. This opportunity cost is difficult to quantify but represents a real institutional burden.\n\nSTRATEGIC RESPONSE OPTIONS:\nYale has several potential approaches to mitigate these impacts:\n\n1. Proactive Communication and Support: Developing comprehensive communication protocols and enhanced support services for international students and scholars will help manage uncertainty and reduce unnecessary complications.\n\n2. Policy Advocacy: Through higher education associations and direct engagement with federal agencies, Yale can advocate for implementation approaches that recognize the importance of international academic exchange while addressing legitimate security concerns.\n\n3. Program Adaptation: Adjusting international program timelines, application deadlines, and contingency planning to accommodate longer visa processing times and potential complications.\n\n4. Global Education Innovation: Exploring hybrid programs, technology-enabled collaborations, and alternative international engagement models that can maintain global academic connections even with increased mobility barriers.\n\nThis executive order represents a Medium impact on Yale University operations, primarily affecting Administrative Compliance and Workforce & Employment Policy dimensions. While not threatening Yale's core academic mission, it creates significant administrative challenges and potential barriers to the university's global engagement goals. Substantial resources will be required to navigate these challenges while maintaining Yale's commitment to international education and research.",
          impactLevel: "Medium",
          categories: ["Immigration", "National Security"],
          universityImpactAreas: ["Administrative Compliance", "Workforce & Employment Policy"]
        }
      },
      {
        order_number: "2025-02012",
        title: "Restoring the Death Penalty and Protecting Public Safety",
        analysis: {
          summary: "This executive order restoring federal death penalty protocols will have minimal direct operational impact on Yale University. However, it creates significant teaching, research, and clinical opportunities for Yale Law School, School of Medicine, and social science departments studying criminal justice policy.",
          executiveBrief: "President Trump's executive order restoring federal death penalty protocols has limited direct operational impact on Yale University, as the institution does not participate in federal capital punishment proceedings. However, the order creates important research, teaching, and clinical implications for several academic units.\n\nYale Law School will experience the most significant academic impact through its Capital Punishment Clinic, Criminal Justice Advocacy Clinic, and related academic programs. Faculty and students engaged in capital defense representation and death penalty jurisprudence research will need to analyze the order's legal implications and potentially adjust litigation strategies and research approaches.\n\nBeyond law, the departments of Sociology, Political Science, and Psychology all maintain research programs examining criminal justice policies, with several faculty specifically focused on capital punishment. The order provides new research opportunities but may also complicate ongoing studies by changing the regulatory landscape mid-research.\n\nFinancially, the direct impact on Yale is minimal, though the university may see modest increases in research funding opportunities related to capital punishment policy analysis. Yale should monitor for any implications related to federally-funded criminal justice research programs but does not need to make significant operational adjustments in response to this order.",
          comprehensiveAnalysis: "Executive Order 2025-02012, \"Restoring the Death Penalty and Protecting Public Safety,\" reinstates and expands federal execution protocols while directing the Department of Justice to expedite capital cases. While Yale University does not participate directly in federal capital punishment administration, this order has several important academic, research, and ethical implications for university programs.\n\nLEGAL EDUCATION AND CLINICAL PROGRAMS:\nYale Law School maintains several programs directly related to capital punishment that will be affected:\n\n1. Capital Punishment Clinic: Yale Law School operates a clinical program representing death-sentenced individuals in post-conviction proceedings. The reinstatement and potential expansion of federal executions will likely increase the urgency and complexity of this work, affecting approximately 10-15 students and 2-3 faculty members annually.\n\n2. Supreme Court Clinic: Law students working in this clinic frequently engage with constitutional issues surrounding capital punishment. The executive order may generate new litigation reaching the Supreme Court, creating both teaching opportunities and increased workload for this program.\n\n3. Criminal Justice Theory and Practice: Several law school courses address capital punishment from theoretical, historical, and practical perspectives. Faculty teaching these courses will need to incorporate analysis of this executive order and its implementation into their curriculum, affecting approximately 150-200 law students annually.\n\nRESEARCH IMPLICATIONS:\nThe order affects research programs across multiple disciplines:\n\n1. Empirical Legal Studies: Yale Law School faculty conducting empirical research on capital punishment outcomes, racial disparities, and effectiveness will have new data points to analyze but may also face methodological challenges with changing implementation policies.\n\n2. Criminal Justice Policy Research: Faculty in Political Science, Sociology, and Public Policy studying criminal justice systems will need to incorporate this significant policy shift into their research frameworks. Approximately 5-7 faculty members maintain active research programs in this area.\n\n3. Psychological Research: Yale's Psychology Department includes researchers studying moral decision-making, punitive attitudes, and the psychological impacts of capital punishment policies on various stakeholders. The policy shift creates new research questions and contexts for these scholars.\n\n4. Medical Ethics Research: Yale School of Medicine faculty engaged in research on medical ethics, particularly regarding physician participation in executions, will have new policy contexts to examine. This affects a small but important research community addressing the intersection of medicine and criminal justice.\n\nTEACHING AND CURRICULUM IMPACTS:\nThe order creates teaching considerations across multiple programs:\n\n1. Ethics Education: Yale College and professional school courses addressing ethics, particularly in medicine, law, and public policy, will need to incorporate discussion of this significant shift in federal policy. This affects approximately 20-30 courses across the university.\n\n2. Criminal Justice Courses: Undergraduate and graduate courses on criminal justice systems will need curricular updates to address this policy change, affecting approximately 10-15 courses and 300-400 students annually.\n\n3. Constitutional Law: Courses addressing constitutional law, federalism, and executive power will find this order provides an important contemporary case study, affecting 5-7 courses at the Law School and in Political Science.\n\nCLINICAL AND COMMUNITY IMPACTS:\nThe order affects Yale's clinical and community engagement programs:\n\n1. Justice Collaboratory: This interdisciplinary research center at Yale Law School studies criminal justice reform and procedural justice. The center's researchers and community engagement work will need to address how this executive order affects reform trajectories and community trust in legal institutions.\n\n2. Solomon Center for Health Law and Policy: This center addresses issues at the intersection of law and healthcare, including end-of-life issues and medical ethics in criminal justice. The order creates new research questions for the center's scholars and practitioners.\n\n3. Community Legal Services: Yale Law School's numerous community-focused clinics may experience increased consultations related to capital punishment issues, particularly from community organizations concerned about the policy shift.\n\nFINANCIAL AND RESOURCE IMPLICATIONS:\nThe direct financial impact on Yale is minimal but includes several considerations:\n\n1. Research Funding Opportunities: The policy shift may generate new federal and foundation funding opportunities for research on capital punishment implementation, effectiveness, and alternatives. Potential research funding opportunities could range from $500,000 to $2 million over five years across affected departments.\n\n2. Clinical Program Resources: Yale Law School's capital punishment clinical programs may experience increased demand, potentially requiring modest additional resources for supervision, travel to client meetings, and litigation support. Estimated additional costs range from $25,000-$75,000 annually depending on case volume.\n\n3. Conference and Convening Expenses: Yale is likely to host academic conferences, workshops, and policy discussions responding to this significant shift in federal criminal justice policy. These activities would likely be funded through existing academic program budgets with minimal financial impact.\n\nSTRATEGIC CONSIDERATIONS:\nYale should consider several strategic approaches:\n\n1. Interdisciplinary Coordination: Establishing coordination mechanisms across the various academic units studying this policy shift would enhance research quality and educational impact. This might include cross-listings between Law School, Social Science, and Public Health courses addressing capital punishment.\n\n2. Academic Leadership: Yale has an opportunity to leverage its academic expertise to inform public discourse around this policy shift through faculty scholarship, public events, and media engagement. This aligns with the university's mission of knowledge creation and dissemination.\n\n3. Research Ethics Planning: For faculty conducting research in areas affected by the policy change, developing clear ethical guidelines for engagement with the criminal justice system under the new protocols would demonstrate institutional commitment to responsible scholarship.\n\nThis executive order represents a Low impact on Yale University's core operations, creating primarily Academic and Research implications rather than administrative or compliance challenges. The university does not need to make significant operational adjustments, but academic units—particularly the Law School—should thoughtfully incorporate this policy shift into their teaching, research, and clinical activities.",
          impactLevel: "Low",
          categories: ["National Security"],
          universityImpactAreas: ["Research Funding"]
        }
      }
    ];

    let successCount = 0;
    
    // Process the batch analysis
    for (const item of batchAnalysis) {
      try {
        console.log(`\nProcessing order with number: ${item.order_number} - ${item.title}`);
        
        // Find the order in our database
        const order = await dbGet(
          'SELECT id, order_number, title FROM executive_orders WHERE order_number = ?', 
          [item.order_number]
        );
        
        if (!order) {
          console.log(`Order not found in database: ${item.order_number}`);
          continue;
        }
        
        // Update order with analysis
        const success = await updateOrderWithAnalysis(order.id, item.analysis);
        if (success) {
          successCount++;
        }
      } catch (error) {
        console.error(`Error processing order ${item.order_number}:`, error);
      }
    }
    
    console.log(`\nAnalysis completed. Successfully analyzed ${successCount} out of ${batchAnalysis.length} orders.`);
    
  } catch (error) {
    console.error("Error in main process:", error);
  } finally {
    // Close the database connection
    db.close();
  }
}

// Run the main function
main();