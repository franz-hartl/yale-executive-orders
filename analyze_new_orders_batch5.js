/**
 * analyze_new_orders_batch5.js
 * 
 * Fifth batch of analyses for executive orders without impact levels.
 */

const sqlite3 = require('sqlite3').verbose();
const path = require('path');
const fs = require('fs');
require('dotenv').config();

// Database connection
const dbPath = path.join(__dirname, 'executive_orders.db');
const db = new sqlite3.Database(dbPath);

// Promisify database operations
function dbRun(sql, params = []) {
  return new Promise((resolve, reject) => {
    db.run(sql, params, function(err) {
      if (err) reject(err);
      else resolve(this);
    });
  });
}

function dbGet(sql, params = []) {
  return new Promise((resolve, reject) => {
    db.get(sql, params, (err, row) => {
      if (err) reject(err);
      else resolve(row);
    });
  });
}

function dbAll(sql, params = []) {
  return new Promise((resolve, reject) => {
    db.all(sql, params, (err, rows) => {
      if (err) reject(err);
      else resolve(rows);
    });
  });
}

// Function to update order with manually defined analysis
async function updateOrderWithAnalysis(orderId, analysis) {
  try {
    console.log(`Updating order ${orderId} with analysis results`);
    
    // Update the executive order with summary and impact level
    await dbRun(
      `UPDATE executive_orders 
       SET summary = ?, 
           impact_level = ?, 
           plain_language_summary = ?,
           executive_brief = ?,
           comprehensive_analysis = ?
       WHERE id = ?`,
      [
        analysis.summary,
        analysis.impactLevel,
        analysis.summary,
        analysis.executiveBrief,
        analysis.comprehensiveAnalysis,
        orderId
      ]
    );
    
    // Update categories
    for (const categoryName of analysis.categories) {
      // Get category ID
      const category = await dbGet('SELECT id FROM categories WHERE name = ?', [categoryName]);
      if (category) {
        // Check if relation already exists
        const existingRelation = await dbGet(
          'SELECT * FROM order_categories WHERE order_id = ? AND category_id = ?',
          [orderId, category.id]
        );
        
        if (!existingRelation) {
          // Add category relation
          await dbRun(
            'INSERT INTO order_categories (order_id, category_id) VALUES (?, ?)',
            [orderId, category.id]
          );
          console.log(`Added category ${categoryName} to order ${orderId}`);
        }
      } else {
        console.log(`Category not found: ${categoryName}`);
      }
    }
    
    // Update university impact areas
    for (const areaName of analysis.universityImpactAreas) {
      // Get impact area ID
      const area = await dbGet('SELECT id FROM university_impact_areas WHERE name = ?', [areaName]);
      if (area) {
        // Check if relation already exists
        const existingRelation = await dbGet(
          'SELECT * FROM order_university_impact_areas WHERE order_id = ? AND university_impact_area_id = ?',
          [orderId, area.id]
        );
        
        if (!existingRelation) {
          // Add impact area relation
          await dbRun(
            'INSERT INTO order_university_impact_areas (order_id, university_impact_area_id) VALUES (?, ?)',
            [orderId, area.id]
          );
          console.log(`Added university impact area ${areaName} to order ${orderId}`);
        }
      } else {
        console.log(`University impact area not found: ${areaName}`);
      }
    }
    
    console.log(`Successfully updated order ${orderId} with analysis results`);
    return true;
  } catch (error) {
    console.error(`Error updating order ${orderId} with analysis:`, error);
    return false;
  }
}

// Main function
async function main() {
  try {
    console.log("Starting analysis of executive orders without impact levels (Batch 5)...");
    
    // Get orders that need analysis (those without impact levels)
    const ordersToAnalyze = await dbAll(`
      SELECT id, order_number, title, signing_date, publication_date, president, summary, full_text, url
      FROM executive_orders 
      WHERE impact_level IS NULL OR impact_level = ''
      ORDER BY signing_date DESC
    `);
    
    console.log(`Found ${ordersToAnalyze.length} orders that still need analysis`);
    
    // Process each order with manual analysis
    const batchAnalysis = [
      {
        order_number: "2025-02091",
        title: "Reevaluating and Realigning United States Foreign Aid",
        analysis: {
          summary: "This executive order reevaluates U.S. foreign aid priorities, potentially affecting Yale's international research collaborations, global health initiatives, and development partnerships. The university should assess programs receiving federal international funding and prepare for possible shifts in funding priorities.",
          executiveBrief: "President Trump's executive order reevaluating U.S. foreign aid will have implications for Yale University's extensive international engagements, particularly those receiving federal funding or operating in regions prioritized by U.S. foreign assistance. While Yale's core educational operations won't be directly regulated by this order, several university programs and initiatives may experience funding shifts or changed operating environments as federal international assistance priorities are realigned.\n\nYale's global health programs, particularly those managed through the School of Public Health and Yale Institute for Global Health, should carefully assess their funding sources and prepare for potential adjustments if they rely on USAID, NIH global health, or State Department funding streams. Similarly, international research collaborations and field programs in regions that may see changing U.S. aid priorities should evaluate contingency strategies for operational and funding continuity.\n\nThe Jackson School of Global Affairs, which maintains numerous connections to international development initiatives, should monitor implementation guidance to understand emerging foreign assistance priorities and align relevant research and educational initiatives accordingly. Overall, while direct financial impact may be contained to specific internationally-focused programs, the university should prepare for an evolving landscape in federally-supported global engagement activities.",
          comprehensiveAnalysis: "Executive Order 2025-02091, \"Reevaluating and Realigning United States Foreign Aid,\" signals a significant recalibration of U.S. international assistance priorities and mechanisms. For Yale University, this order creates multifaceted implications across its global research initiatives, educational programs, and international partnerships.\n\nINTERNATIONAL RESEARCH IMPLICATIONS:\nYale conducts extensive research with global implications, often intersecting with U.S. foreign assistance priorities:\n\n1. Global Health Research: Yale School of Public Health and Yale School of Medicine manage numerous research initiatives in developing nations that often leverage or align with USAID, CDC, NIH, or other federal global health funding. Programs studying infectious diseases, maternal and child health, or health systems strengthening may experience shifts in funding priorities or geographic focus areas.\n\n2. Climate and Environmental Research: Yale School of the Environment maintains field research sites in regions receiving U.S. environmental assistance. Changes to environmental aid priorities could affect research partnerships, data collection opportunities, or collaboration frameworks in these regions.\n\n3. Development Economics: Faculty conducting research on economic development, governance, or poverty alleviation may see changes in research opportunities as U.S. development assistance priorities shift, potentially affecting both funding streams and field research access.\n\n4. International Grant Landscape: Yale researchers competing for federal grants with international components may need to realign proposals with emerging priorities articulated through the order's implementation guidance.\n\nEDUCATIONAL PROGRAM CONSIDERATIONS:\nYale's educational mission includes substantial international components:\n\n1. International Fellowship Programs: Programs placing Yale students in international development contexts, particularly those leveraging federal funding like Fulbright or Boren scholarships, may experience changing geographic or thematic priorities.\n\n2. Study Abroad Operations: While primarily privately funded, some Yale study abroad programs operate in regions where changing U.S. assistance priorities could affect operating environments or partnership opportunities.\n\n3. Jackson School of Global Affairs: As Yale's newest professional school focused on global leadership, the Jackson School's curriculum, case studies, and practical training opportunities may need adaptation to reflect evolving U.S. foreign assistance frameworks.\n\n4. Experiential Learning Initiatives: Programs providing students with hands-on experience in international development contexts may need to adjust focus areas to align with shifting U.S. priorities.\n\nINSTITUTIONAL PARTNERSHIP IMPLICATIONS:\nYale maintains numerous international institutional relationships:\n\n1. University Partnerships: Yale's partnerships with universities in regions receiving U.S. assistance may experience changing external environments as aid priorities shift.\n\n2. NGO Collaborations: Yale programs collaborating with non-governmental organizations that receive U.S. foreign assistance may need to navigate partner funding transitions.\n\n3. Multilateral Organization Engagement: Yale's engagement with multilateral organizations like the UN, World Bank, or WHO may require recalibration as U.S. contributions and priorities within these organizations evolve.\n\n4. Corporate Partnership Alignment: Public-private partnerships involving Yale, corporations, and development agencies may need strategic reassessment as government priorities shift.\n\nFINANCIAL CONSIDERATIONS:\nThe financial impact on Yale will vary by program area:\n\n1. Direct Federal Funding: Yale programs receiving USAID, State Department, or other foreign assistance funding may face the most immediate financial implications, with potential for both funding reductions in deprioritized areas and new opportunities in newly prioritized domains.\n\n2. Indirect Funding Effects: Programs relying on implementing partners funded by U.S. foreign aid may experience secondary effects as these partners navigate changing funding landscapes.\n\n3. Endowment Considerations: Yale's investment policies regarding international development-related investments may warrant review in light of changing U.S. government priorities.\n\n4. Philanthropic Alignment: The university's development strategies for internationally-focused initiatives may need refinement as governmental and philanthropic priorities potentially diverge or realign.\n\nSTRATEGIC RESPONSE APPROACHES:\nYale should consider several approaches to navigate this evolving landscape:\n\n1. Priority Analysis: Conduct a comprehensive inventory of Yale programs receiving or aligning with U.S. foreign assistance to identify areas of potential impact.\n\n2. Diversification Strategy: For vulnerable programs, develop funding diversification strategies to reduce dependence on U.S. government sources potentially subject to reprioritization.\n\n3. Monitoring Mechanism: Establish a coordinated approach to tracking implementation guidance across relevant federal agencies (USAID, State Department, MCC, etc.) to identify emerging priorities.\n\n4. Strategic Opportunity Identification: Position Yale expertise to address newly prioritized areas through targeted research initiatives, educational programs, or policy engagement.\n\n5. Partnership Reassessment: Review international institutional partnerships in light of changing aid landscapes to identify both vulnerabilities and new collaboration opportunities.\n\nCOMPLIANCE CONSIDERATIONS:\nChanging foreign aid priorities may create new compliance frameworks:\n\n1. Award Terms: New compliance requirements may emerge in federal funding agreements for international activities, requiring enhanced monitoring and documentation.\n\n2. Reporting Frameworks: Changes to performance measurement or evaluation requirements for federally funded international programs may necessitate adjustments to Yale's monitoring and evaluation approaches.\n\n3. Due Diligence Requirements: Enhanced partner vetting or due diligence requirements may emerge for activities in certain regions or thematic areas.\n\nThe executive order represents a medium impact on Yale University operations, primarily affecting specific programs and initiatives with international development dimensions rather than core university functions. The most significant university impact areas will be Research Funding (particularly for globally-oriented research) and Public-Private Partnerships (especially those involving international development actors). While not requiring immediate university-wide action, the order signals a need for thoughtful strategic assessment by leaders of Yale's internationally-focused programs and initiatives.",
          impactLevel: "Medium",
          categories: ["Education", "Finance"],
          universityImpactAreas: ["Research Funding", "Public-Private Partnerships"]
        }
      },
      {
        order_number: "2025-02090",
        title: "Defending Women From Gender Ideology Extremism and Restoring Biological Truth to the Federal Government",
        analysis: {
          summary: "This executive order revises federal gender identity policies, potentially affecting Yale's implementation of Title IX, non-discrimination policies, healthcare practices, and research protocols. The university will need to navigate federal changes while maintaining institutional values and state law compliance.",
          executiveBrief: "President Trump's executive order on gender identity policies will have significant implications for Yale University's compliance framework, healthcare operations, and campus climate considerations. The order likely modifies how federal agencies interpret gender identity protections, potentially affecting multiple domains of university operations that intersect with federal requirements or funding.\n\nYale's Title IX Office and General Counsel will need to thoroughly assess how changes to federal interpretations intersect with institutional non-discrimination policies, Connecticut state law requirements, and Yale's values framework. Healthcare services, particularly Yale Health and clinical programs at Yale School of Medicine, may need to reevaluate coverage policies, care protocols, and documentation practices for transgender patients in light of changing federal guidelines.\n\nResearch programs studying gender identity, particularly those receiving federal funding, may face evolving compliance requirements or documentation standards. Athletic programs will need to evaluate potential impacts on transgender student-athlete participation policies in coordination with NCAA guidelines. Throughout this process, Yale must navigate carefully between federal compliance requirements and institutional commitments to inclusivity, ensuring appropriate accommodation of all community members while meeting legal obligations.",
          comprehensiveAnalysis: "Executive Order 2025-02090, \"Defending Women From Gender Ideology Extremism and Restoring Biological Truth to the Federal Government,\" represents a significant shift in federal policy regarding gender identity. For Yale University, this creates a complex landscape requiring careful navigation across multiple institutional domains, from compliance and healthcare to campus climate and academic programs.\n\nCOMPLIANCE AND POLICY IMPLICATIONS:\nAs a recipient of substantial federal funding, Yale faces complex compliance considerations:\n\n1. Title IX Implementation: Yale's Title IX Office will need to reassess its implementation framework as federal interpretations of sex discrimination protections evolve. This may require reviewing policies on gender identity accommodations, facility access, and complaint procedures.\n\n2. Non-Discrimination Policies: The university's broader non-discrimination statements and policies may require careful review to ensure they appropriately balance federal compliance requirements with institutional values and Connecticut state law, which offers explicit protections based on gender identity.\n\n3. Federal Funding Requirements: Programs receiving specific federal grants may face new certification or documentation requirements regarding sex and gender categorizations, requiring careful compliance monitoring.\n\n4. Policy Documentation: Yale may need to enhance documentation of the rationale for its approach to gender identity policies, clearly distinguishing between compliance minimums and institutional values-based decisions.\n\nHEALTHCARE CONSIDERATIONS:\nYale's healthcare enterprises face several significant considerations:\n\n1. Yale Health Services: The university's health plan will need to review coverage policies for gender-affirming care in light of changing federal interpretations, particularly for plans that intersect with federal funding or compliance frameworks.\n\n2. Clinical Documentation: Medical record systems and documentation practices may require adjustment to accommodate changing federal standards for sex and gender documentation while maintaining appropriate clinical care.\n\n3. Medical Education: Training for healthcare providers regarding transgender healthcare may need reevaluation to ensure it meets evolving federal guidelines while maintaining clinical best practices.\n\n4. Research Protocols: Studies involving gender identity or transgender participants may need enhanced IRB review to ensure compliance with changing federal interpretations.\n\nCAMPUS LIFE AND FACILITIES:\nSeveral aspects of campus operations may require reassessment:\n\n1. Housing Policies: Residential life policies regarding gender-inclusive housing options may need review to ensure they appropriately balance federal requirements, state law, and institutional values.\n\n2. Facility Access: Policies governing access to gendered facilities like restrooms and locker rooms may require reevaluation in light of changing federal interpretations.\n\n3. Information Systems: Student and employee information systems may need adjustment to accommodate changing federal standards for sex and gender documentation.\n\n4. Athletic Programs: Policies regarding transgender student-athlete participation may require reassessment, particularly as they intersect with NCAA guidelines and federal interpretations.\n\nACADEMIC AND RESEARCH IMPACTS:\nYale's academic mission interfaces with these policy changes in several ways:\n\n1. Research Funding: Studies focusing on gender identity, particularly those receiving federal funding, may face evolving compliance requirements or documentation standards.\n\n2. Curriculum Content: Courses addressing gender identity in fields like psychology, sociology, or gender studies may need to acknowledge changing federal policy landscapes while maintaining academic integrity.\n\n3. Academic Freedom Considerations: Yale must carefully navigate tensions between federal policy directives and principles of academic freedom in teaching and research related to gender identity.\n\n4. Clinical Training: Programs preparing healthcare providers must balance evolving federal guidelines with clinical best practices and ethical standards in transgender healthcare.\n\nSTAKEHOLDER ENGAGEMENT CONSIDERATIONS:\nThe executive order creates complex stakeholder dynamics that require thoughtful navigation:\n\n1. Transgender Community Members: Yale must continue supporting transgender students, faculty, and staff while navigating changing federal frameworks, requiring careful communication and resource provision.\n\n2. Campus Climate: The university should anticipate potential campus climate impacts as federal policies shift, and prepare appropriate community support and dialogue opportunities.\n\n3. External Constituencies: Yale may face divergent expectations from various external stakeholders, including federal agencies, state government, alumni, and advocacy organizations.\n\n4. Internal Coordination: Effective implementation requires careful coordination across multiple university units, including General Counsel, Title IX Office, Human Resources, Student Affairs, and academic departments.\n\nSTRATEGIC RESPONSE APPROACHES:\nYale should consider several approaches in responding to this executive order:\n\n1. Comprehensive Policy Review: Conduct a thorough assessment of all policies potentially affected by changing federal interpretations, identifying areas requiring adjustment while preserving institutional values where legally permissible.\n\n2. Legal Framework Analysis: Carefully analyze the interplay between federal requirements, Connecticut state law protections, and institutional policies to identify proper compliance approaches.\n\n3. Communication Strategy: Develop clear communication for the university community explaining any necessary policy adjustments while affirming continued support for transgender community members.\n\n4. Resource Allocation: Ensure appropriate resources for compliance implementation while maintaining support services for affected community members.\n\n5. Peer Institution Coordination: Engage with peer institutions to develop consistent approaches to common challenges and share effective practices.\n\nThe executive order represents a high impact on Yale University operations, primarily affecting Administrative Compliance procedures and potentially Workforce & Employment Policy. The university faces the complex challenge of meeting federal compliance requirements while maintaining its institutional values and fulfilling state law obligations—a balance that requires thoughtful and deliberate policy development across multiple domains.",
          impactLevel: "High",
          categories: ["Education", "Healthcare"],
          universityImpactAreas: ["Administrative Compliance", "Workforce & Employment Policy"]
        }
      },
      {
        order_number: "2025-02089",
        title: "Clarifying the Military's Role in Protecting the Territorial Integrity of the United States",
        analysis: {
          summary: "This executive order clarifies military roles in border security with minimal direct impact on Yale. Potential indirect effects may include adjustments to certain defense research priorities, international student documentation processes, and curriculum content in relevant academic programs.",
          executiveBrief: "President Trump's executive order clarifying the military's role in border security has limited direct impact on Yale University's operations, as it primarily addresses governmental security frameworks rather than educational institutions. However, the order creates several peripheral considerations for certain university functions that intersect with defense priorities, immigration processes, or international education.\n\nYale researchers working on defense-related projects, particularly those focusing on border security technologies, surveillance systems, or relevant legal frameworks, may see evolving research priorities from Department of Defense funding sources. The Office of International Students and Scholars should monitor for any changes to documentation or verification processes for international students that might emerge as part of broader security system adjustments, though immediate impacts are unlikely.\n\nAcademic programs addressing national security, immigration law, or military operations, particularly at the Law School or Jackson School of Global Affairs, may need to incorporate these evolving frameworks into relevant course content. While requiring minimal direct action, the order suggests maintaining awareness of evolving national security approaches that may indirectly affect specific research or educational domains.",
          comprehensiveAnalysis: "Executive Order 2025-02089, \"Clarifying the Military's Role in Protecting the Territorial Integrity of the United States,\" focuses on defining and potentially expanding military involvement in border security operations. While Yale University is not directly regulated by national security directives, this executive order creates several indirect considerations for university programs and activities that intersect with defense priorities, immigration processes, or international education.\n\nRESEARCH IMPLICATIONS:\nYale conducts research across domains that may experience subtle effects:\n\n1. Defense-Related Research: Faculty receiving Department of Defense funding for projects related to surveillance technologies, autonomous systems, or security frameworks may see evolving priorities as military border security roles expand.\n\n2. Legal and Policy Research: Scholars studying the legal frameworks for military operations, particularly the intersection of national security and immigration enforcement, may find new research questions emerging from this policy shift.\n\n3. Regional Security Studies: Research focused on border regions, transnational threats, or migration patterns may need to account for changing operational approaches in these areas.\n\n4. Technology Development: Engineering research with potential dual-use applications in border security contexts may experience indirect effects on funding priorities or application contexts.\n\nINTERNATIONAL STUDENT CONSIDERATIONS:\nYale's international community represents over 120 countries:\n\n1. Documentation Processes: While immediate effects are unlikely, there is potential for eventual adjustments to documentation or verification processes for international students as part of broader security system enhancements.\n\n2. Border Crossing Experiences: International students and scholars may experience modified entry procedures when crossing U.S. borders as military roles in these operations evolve, potentially requiring updated guidance from Yale's international office.\n\n3. Perception Management: Enhanced military presence at borders may create perception challenges for international recruitment, requiring thoughtful communication strategies for prospective students from certain regions.\n\n4. Consular Processing: Changes to security operations could eventually influence visa processing timelines or procedures, though such effects would likely emerge gradually rather than immediately.\n\nACADEMIC PROGRAM CONSIDERATIONS:\nCertain Yale academic programs intersect with security frameworks:\n\n1. Jackson School of Global Affairs: Courses addressing national security, border management, or migration policy may need curricular updates to reflect evolving operational approaches in these domains.\n\n2. Law School: Programs examining immigration law, national security law, or constitutional boundaries of military operations may incorporate these policy developments into teaching materials.\n\n3. Political Science Department: Courses analyzing federal power distribution, security policy formulation, or civil-military relations may find relevant case studies in the implementation of this order.\n\n4. Practice-Based Learning: Programs placing students in government roles related to security or immigration may experience changing professional contexts in these placements.\n\nFIELD RESEARCH CONSIDERATIONS:\nYale researchers conducting field studies in relevant contexts may experience operational adjustments:\n\n1. Border Region Research: Faculty conducting field research in U.S. border regions may encounter modified security environments affecting research access or methodology.\n\n2. Migration Studies: Research tracking migration patterns or interviewing migrant populations may need to account for changing enforcement approaches in research design.\n\n3. Research Permissions: Projects requiring access to security-sensitive locations may face evolving permission frameworks as operational responsibilities shift between agencies.\n\nINSTITUTIONAL PARTNERSHIP IMPLICATIONS:\nYale maintains various partnerships that could experience peripheral effects:\n\n1. Military Educational Collaborations: Yale's educational partnerships with military institutions or leadership development programs may see curriculum adjustments reflecting expanded border security roles.\n\n2. International University Partnerships: Collaborations with universities in border regions may experience contextual shifts affecting joint research or exchange programs.\n\n3. Government Agency Relationships: Yale's engagement with security-related agencies may require navigating evolving jurisdictional boundaries in certain collaborative contexts.\n\nFINANCIAL IMPLICATIONS:\nThe financial impact on Yale is expected to be minimal:\n\n1. Research Priorities: Minor adjustments to defense research funding priorities may affect a small subset of Yale research programs, but without significant overall financial impact.\n\n2. Compliance Adjustments: Limited resources may be required for any administrative adaptations to evolving documentation requirements for international community members.\n\n3. Program Content Updates: Minimal costs associated with updating academic content in relevant programs to reflect policy changes.\n\nSTRATEGIC RESPONSE CONSIDERATIONS:\nYale should consider several proportionate approaches in response to this executive order:\n\n1. Targeted Monitoring: Implement focused monitoring of implementation guidance that might affect international student processes or research security requirements.\n\n2. Academic Integration: Encourage faculty in relevant disciplines to incorporate these policy developments into teaching and research as appropriate examples of evolving security frameworks.\n\n3. International Support Resources: Ensure international student support services are prepared to provide updated guidance if border crossing procedures evolve.\n\n4. Research Opportunity Identification: Position relevant research programs to address emerging questions about the legal, operational, and policy implications of expanded military border security roles.\n\nThe executive order represents a low impact on Yale University operations. While creating limited considerations for specific programs, it does not significantly affect core university functions or require substantial operational adjustments. The primary university impact areas are Research Funding (for defense-related research) and Administrative Compliance (regarding international student processes), though effects in both domains are expected to be minor and incremental rather than immediate or disruptive.",
          impactLevel: "Low",
          categories: ["National Security", "Immigration"],
          universityImpactAreas: ["Administrative Compliance", "Research Funding"]
        }
      },
      {
        order_number: "2025-02087",
        title: "Application of Protecting Americans From Foreign Adversary Controlled Applications Act to TikTok",
        analysis: {
          summary: "This executive order restricts TikTok usage, affecting Yale's digital communications, social media policies, and certain research activities. The university should revise technology usage guidelines, develop alternative outreach platforms, and ensure research compliance with new restrictions.",
          executiveBrief: "President Trump's executive order restricting TikTok usage will impact several aspects of Yale University operations, particularly those related to digital communications, technology policies, and certain research activities. While the specific restrictions will determine the precise impact, Yale will need to develop a comprehensive response strategy to maintain effective digital engagement while ensuring compliance.\n\nYale's Information Technology Services should lead the development of updated technology usage guidelines for university-owned devices and networks, clarifying permitted applications and providing alternative platforms for digital content sharing. The Office of Public Affairs and Communications will need to revise social media strategies that currently use TikTok for student recruitment, campus life showcasing, or institutional messaging, potentially developing alternative channel strategies to reach prospective students and other key constituencies.\n\nResearch projects studying social media usage, internet governance, or related topics that involve TikTok may need methodology adjustments and potential IRB protocol reviews. Student organizations currently using TikTok for outreach or engagement will require guidance on alternative platforms and transition support. Throughout this process, Yale should balance compliance requirements with academic freedom considerations, particularly for research and teaching contexts studying digital platforms.",
          comprehensiveAnalysis: "Executive Order 2025-02087, \"Application of Protecting Americans From Foreign Adversary Controlled Applications Act to TikTok,\" implements restrictions on TikTok usage in the United States. For Yale University, this creates multifaceted implications across institutional communications, information technology policies, academic activities, and student engagement.\n\nINFORMATION TECHNOLOGY POLICY IMPLICATIONS:\nYale's technology infrastructure and policies require adaptation:\n\n1. Device Management: For approximately 14,000+ university-owned devices (computers, tablets, phones) used by faculty and staff, Yale Information Technology Services will need to implement technical measures to restrict TikTok installation or usage, likely through mobile device management (MDM) systems and application whitelisting/blacklisting policies.\n\n2. Network Management: Yale's campus network infrastructure may require configuration changes to restrict TikTok access, potentially implementing selective traffic filtering on university networks while ensuring academic exceptions where appropriate.\n\n3. BYOD Policies: Bring-your-own-device policies will need review and clarification regarding acceptable application usage on personal devices when conducting university business or accessing university resources.\n\n4. Compliance Documentation: New compliance tracking mechanisms may be needed to document institutional efforts to implement and enforce restrictions, potentially requiring updates to acceptable use policies and user agreements.\n\nCOMMUNICATIONS AND MARKETING IMPACTS:\nYale's digital outreach strategies require recalibration:\n\n1. Institutional Social Media: Yale's central communications office and various departments have established TikTok presences for student recruitment, campus life showcasing, and institutional messaging that will require migration to alternative platforms.\n\n2. Audience Engagement: Communications staff will need to develop alternative channel strategies to reach key constituencies, particularly prospective students and younger audiences where TikTok has been an effective engagement platform.\n\n3. Content Strategy: Digital content specifically designed for TikTok's format and audience will need repurposing for alternative platforms, potentially requiring production workflow adjustments and creative strategy modifications.\n\n4. International Communications: Yale's global engagement efforts, particularly those targeting regions where TikTok remains prominent, may require region-specific alternative strategies.\n\nACADEMIC AND RESEARCH CONSIDERATIONS:\nYale's academic mission interfaces with these restrictions in several ways:\n\n1. Internet Studies Research: Faculty and students researching social media, digital culture, Chinese technology policy, or platform governance may require special provisions to maintain research access for scholarly purposes.\n\n2. Media Analysis: Courses analyzing digital media, particularly in communications, sociology, anthropology, or digital humanities fields, may need methodology adjustments for assignments or projects previously involving TikTok.\n\n3. International Collaborations: Research partnerships with international institutions may face complications if collaborators operate under different regulatory frameworks regarding TikTok access.\n\n4. Data Access: Researchers using TikTok data for studies on information diffusion, cultural trends, or user behavior may need alternative data sources or special exemptions for academic purposes.\n\nSTUDENT LIFE IMPLICATIONS:\nThe restrictions affect various aspects of student engagement:\n\n1. Student Organizations: Approximately 300+ Yale student organizations currently using TikTok for outreach, event promotion, or community building will need guidance on platform transitions and alternative engagement strategies.\n\n2. Admissions and Recruitment: Student ambassadors and admissions programs utilizing TikTok for prospective student outreach will require alternative platforms and content strategies.\n\n3. Campus Programming: Events or initiatives incorporating TikTok-based activities or promotions will need redesign with alternative platforms or approaches.\n\n4. International Students: Students from countries where TikTok remains prominent may experience disconnection from home networks or communities, potentially requiring additional support resources.\n\nLEGAL AND COMPLIANCE FRAMEWORK:\nYale must navigate several compliance considerations:\n\n1. Scope Interpretation: Careful legal analysis is needed to determine which university activities fall within restriction parameters, particularly regarding exceptions for research, teaching, or international operations.\n\n2. Implementation Documentation: Systematic documentation of compliance efforts will be important for demonstrating good-faith implementation if questioned by regulatory authorities.\n\n3. Academic Freedom Balancing: Legal framework development should carefully balance compliance requirements with academic freedom protection, particularly for scholarly work studying digital platforms or Chinese technology policy.\n\n4. International Campus Considerations: Yale-NUS College and other international operations may require different implementation approaches depending on local legal frameworks.\n\nFINANCIAL IMPLICATIONS:\nThe financial impact will manifest through several channels:\n\n1. Implementation Costs: One-time expenses for technology policy updates, communication strategy revisions, and compliance mechanism development (estimated at $75,000-$150,000).\n\n2. Operational Adjustments: Ongoing costs for alternative platform subscriptions, modified content production workflows, and compliance monitoring (estimated at $50,000-$100,000 annually).\n\n3. Strategic Investments: Potential investments in emerging alternative platforms to maintain effective digital engagement with key constituents, particularly prospective students.\n\n4. Research Modification Costs: Resources needed to support research methodology adjustments for studies previously involving TikTok (highly variable depending on affected projects).\n\nSTRATEGIC RESPONSE APPROACHES:\nYale should consider several approaches in responding to this executive order:\n\n1. Policy Working Group: Establish a cross-functional team including IT, communications, legal counsel, and academic representatives to develop comprehensive implementation strategies.\n\n2. Tiered Implementation: Develop a phased approach prioritizing clear restrictions for official university accounts and devices while carefully addressing more complex academic usage scenarios.\n\n3. Alternative Platform Strategy: Proactively identify and develop presence on alternative short-form video platforms to maintain engagement capabilities with key constituencies.\n\n4. Academic Exception Framework: Create a clear process for requesting and documenting academic exceptions for legitimate research and teaching purposes.\n\n5. Community Education: Develop comprehensive communication explaining the restrictions, their rationale, and approved alternatives for various university functions.\n\nThe executive order represents a medium impact on Yale University operations. While not affecting core academic or administrative functions, it creates significant adjustments for digital engagement strategies and requires policy development across multiple domains. The primary university impact areas are Administrative Compliance (regarding technology usage policies) and potentially Research Funding (for studies involving social media platforms). Yale will need to balance compliance requirements with maintaining effective digital engagement and preserving academic freedom for legitimate scholarly purposes.",
          impactLevel: "Medium",
          categories: ["Technology", "National Security"],
          universityImpactAreas: ["Administrative Compliance", "Research Funding"]
        }
      },
      {
        order_number: "2025-02015",
        title: "Securing Our Borders",
        analysis: {
          summary: "This executive order strengthens border security measures with limited direct impact on Yale. Potential effects include adjustments to international student processes, research access to border regions, and curriculum updates in relevant academic programs.",
          executiveBrief: "President Trump's executive order on border security will have modest implications for Yale University, primarily affecting functions that intersect with immigration processes, international education, or border-related research. While the core academic and operational activities of the university will not be directly regulated by this order, several peripheral areas warrant monitoring and potential adaptation.\n\nYale's Office of International Students and Scholars should anticipate potential adjustments to visa processes, documentation requirements, or verification procedures for international students and scholars as broader immigration enforcement mechanisms evolve. While dramatic changes to established academic visa programs are unlikely, incremental process modifications may emerge that require updated guidance for the university's international community.\n\nResearchers working in border regions or studying migration patterns may experience changed field research conditions, potentially affecting access or methodology for certain projects. Academic programs addressing immigration policy, border security, or related topics, particularly at the Law School or Jackson School of Global Affairs, may need to incorporate these policy developments into relevant curriculum. Yale should maintain awareness of implementation developments while preparing targeted adaptations for specifically affected programs and services.",
          comprehensiveAnalysis: "Executive Order 2025-02015, \"Securing Our Borders,\" implements enhanced border security and immigration enforcement measures. While Yale University's core operations are not directly regulated by immigration enforcement directives, this executive order creates several indirect considerations for university functions that interface with international mobility, border regions, or immigration processes.\n\nINTERNATIONAL STUDENT AND SCHOLAR IMPLICATIONS:\nYale hosts approximately 3,000 international students and scholars from over 120 countries:\n\n1. Visa Processing: Enhanced security screening or verification procedures may affect visa processing timelines or documentation requirements for incoming international students and scholars, potentially requiring additional planning time for academic appointments or program starts.\n\n2. SEVIS Compliance: The Student and Exchange Visitor Information System (SEVIS) reporting requirements may experience incremental adjustments as immigration enforcement mechanisms evolve, requiring updated training for designated school officials.\n\n3. Entry Procedures: International community members may experience modified port-of-entry procedures when entering or re-entering the United States, necessitating updated guidance from Yale's international office.\n\n4. Campus Climate: Heightened national focus on border security may create perception challenges or concerns among international community members, requiring thoughtful communication and support resources.\n\nRESEARCH CONSIDERATIONS:\nCertain Yale research activities intersect with border regions or immigration topics:\n\n1. Field Research Access: Faculty conducting research in border regions may experience changed access conditions or additional permission requirements as security operations intensify.\n\n2. Migration Studies: Research tracking migration patterns or interviewing migrant populations may need methodological adjustments to account for changing enforcement environments.\n\n3. Data Availability: Researchers using government immigration data may see changes in data collection parameters or availability as enforcement priorities shift.\n\n4. Research Ethics: IRB protocols for studies involving vulnerable migrant populations may require additional review in light of changing enforcement contexts.\n\nACADEMIC PROGRAM IMPLICATIONS:\nSeveral Yale academic programs address topics related to immigration or border security:\n\n1. Law School: Programs examining immigration law, enforcement policies, or related constitutional questions may need curricular updates to incorporate these policy developments.\n\n2. Jackson School of Global Affairs: Courses addressing migration policy, border management, or hemispheric relations may require content adjustments to reflect evolving operational approaches.\n\n3. Sociology and Anthropology: Classes studying migration patterns, immigrant communities, or transnational networks may need to account for changing enforcement contexts in teaching materials.\n\n4. Medical and Public Health Programs: Courses addressing migrant health issues may need to incorporate changing access patterns or service delivery models resulting from enhanced enforcement.\n\nGLOBAL STRATEGY CONSIDERATIONS:\nYale's international engagements may experience contextual shifts:\n\n1. Recruitment Diversity: International student recruitment strategies may require adjustment to address perception challenges in certain regions or demographic groups.\n\n2. Cross-Border Programs: Educational programs spanning the U.S.-Mexico border may experience operational adjustments as border security measures intensify.\n\n3. International Partnerships: Collaborations with institutions in countries experiencing significant migration outflows may face evolving contextual challenges.\n\n4. Global Citizenship Education: Programs preparing students for global engagement may need to incorporate changing border mobility contexts into preparatory materials.\n\nCAMPUS OPERATIONS:\nCertain operational aspects warrant consideration:\n\n1. Employment Verification: While Yale already conducts thorough employment eligibility verification, heightened enforcement may lead to evolving best practices or documentation standards for I-9 processes.\n\n2. Contractor Management: Enhanced immigration enforcement may affect certain service contractors, particularly in construction, food service, or maintenance sectors, potentially requiring additional due diligence in contracting processes.\n\n3. Campus Visits: International visitors for conferences, speaking engagements, or collaborative meetings may experience changed entry procedures requiring additional planning or documentation.\n\nFINANCIAL IMPLICATIONS:\nThe financial impact on Yale is expected to be minimal:\n\n1. Administrative Adjustments: Minor costs associated with updating guidance materials, training staff on evolving procedures, or modifying certain documentation processes.\n\n2. Support Resources: Potential modest investments in enhanced support services for international community members navigating changed immigration processes.\n\n3. Research Adaptations: Limited expenses related to modifying research methodologies or access strategies for projects in affected regions or populations.\n\nSTRATEGIC RESPONSE CONSIDERATIONS:\nYale should consider several proportionate approaches in response to this executive order:\n\n1. Information Monitoring: Implement focused tracking of implementation guidance from relevant agencies (DHS, ICE, CBP, State Department) to identify specific operational impacts on academic institutions.\n\n2. International Community Support: Provide clear, measured communication to international students and scholars addressing any process changes while avoiding unnecessary concern.\n\n3. Legal Analysis: Conduct careful review of implementation directives to identify any provisions with specific implications for academic institutions or educational visa categories.\n\n4. Peer Institution Coordination: Engage with higher education associations and peer institutions to develop consistent approaches to common challenges and share effective practices.\n\nThe executive order represents a low impact on Yale University operations. While creating modest considerations for specific functions related to international education and research, it does not significantly affect core university operations or require substantial policy overhauls. The primary university impact areas are Administrative Compliance (regarding international student processes) and potentially Research Funding (for border-related research activities). Yale should maintain awareness of implementation developments while preparing targeted adaptations for specifically affected programs and services.",
          impactLevel: "Low",
          categories: ["Immigration", "National Security"],
          universityImpactAreas: ["Administrative Compliance", "Workforce & Employment Policy"]
        }
      },
      {
        order_number: "2025-02012",
        title: "Restoring the Death Penalty and Protecting Public Safety",
        analysis: {
          summary: "This executive order impacts federal death penalty policy, primarily affecting Yale Law School's clinic activities, criminal justice research, and related academic programs. The university should prepare for increased activity in death penalty litigation clinics and related scholarship.",
          executiveBrief: "President Trump's executive order on federal death penalty policy will have limited direct impact on Yale University's core operations, but creates significant implications for certain specialized academic programs, particularly at Yale Law School. The primary effects will be concentrated in specific clinical, research, and educational domains related to criminal justice and constitutional law.\n\nYale Law School's Capital Punishment Clinic and related litigation programs may experience increased activity as federal death penalty prosecutions potentially increase, creating both challenges and educational opportunities. This could require additional resource allocation to support expanded clinical caseloads and student engagement in this specialized area of practice. Faculty engaged in criminal justice policy, constitutional law, or human rights research may find evolving research questions and policy engagement opportunities as federal capital punishment approaches shift.\n\nBeyond direct Law School impacts, interdisciplinary programs addressing criminal justice topics may need curricular updates, including related courses in sociology, psychology, ethics, or public policy. While these academic adjustments are relatively contained to specific programs, they represent meaningful considerations for faculty and students in these specialized fields.",
          comprehensiveAnalysis: "Executive Order 2025-02012, \"Restoring the Death Penalty and Protecting Public Safety,\" signals a significant shift in federal capital punishment policy. For Yale University, this policy change creates focused impacts in specific academic domains rather than broad operational effects, with implications concentrated in legal education, criminal justice research, and related interdisciplinary programs.\n\nLEGAL EDUCATION IMPLICATIONS:\nYale Law School's clinical and educational programs face several significant considerations:\n\n1. Capital Punishment Clinic: Yale Law School's clinical program addressing death penalty litigation may experience increased case opportunities and student engagement as federal capital prosecutions potentially increase. This could require additional faculty supervision resources, case management systems, and practice resources to support expanded clinical activities.\n\n2. Criminal Procedure Curriculum: Courses addressing federal criminal procedure, sentencing guidelines, and post-conviction remedies may need content updates to reflect evolving federal capital punishment approaches.\n\n3. Supreme Court Litigation Clinic: As capital punishment policies potentially generate constitutional challenges, Yale's Supreme Court clinic may encounter new litigation opportunities in this domain.\n\n4. Judicial Clerkship Preparation: Students pursuing federal clerkships may require enhanced preparation for capital case involvement, particularly for positions in jurisdictions with significant federal criminal dockets.\n\nRESEARCH ENTERPRISE IMPACTS:\nYale's research activities intersect with capital punishment policy in several fields:\n\n1. Empirical Legal Studies: Faculty conducting empirical research on deterrence effects, racial disparities, or cost analyses of capital punishment may find renewed relevance and data availability for their work.\n\n2. Constitutional Law Scholarship: Legal scholars focusing on Eighth Amendment jurisprudence, federal-state relations, or executive power will likely find new research questions emerging from implementation of this order.\n\n3. Ethics and Philosophy Research: Academic work examining ethical dimensions of punishment, state authority, or moral philosophy related to capital punishment may experience increased attention and engagement opportunities.\n\n4. Public Policy Analysis: Research analyzing cost-effectiveness, implementation challenges, or comparative aspects of capital punishment policies may require methodological updates to account for evolving federal approaches.\n\nINTERDISCIPLINARY PROGRAM CONSIDERATIONS:\nVarious Yale programs beyond the Law School address topics related to criminal justice:\n\n1. Institution for Social and Policy Studies: Research initiatives examining criminal justice policy may need to incorporate changing federal capital punishment approaches into ongoing work.\n\n2. Psychology Department: Faculty studying psychological aspects of criminal justice, including jury decision-making, witness reliability, or trauma effects, may find new research contexts emerging from federal policy shifts.\n\n3. Ethics Programs: Interdisciplinary initiatives addressing ethical dimensions of public policy may find renewed engagement with capital punishment questions across multiple fields.\n\n4. Public Health Research: Studies examining public health dimensions of criminal justice policy may need to consider changing federal approaches in research design and policy recommendations.\n\nINSTITUTIONAL ENGAGEMENT CONSIDERATIONS:\nYale's broader institutional voice interacts with this policy domain in several ways:\n\n1. Public Events: University forums, debates, or speaker series addressing criminal justice topics may experience increased interest and engagement opportunities related to capital punishment policy.\n\n2. Alumni Engagement: Yale alumni working in criminal justice fields, whether as prosecutors, defense attorneys, or policy advocates, may seek increased engagement with relevant university programs.\n\n3. External Partnerships: Collaborations with government agencies, nonprofit organizations, or research institutions in the criminal justice domain may experience evolving priorities and engagement opportunities.\n\n4. Media Engagement: Faculty expertise on capital punishment may see increased media interest, creating both opportunities and challenges for scholarly communication on complex policy questions.\n\nSTUDENT INTEREST AND CAREER DEVELOPMENT:\nThe policy shift may influence student engagement patterns:\n\n1. Clinical Program Interest: Law students may demonstrate increased interest in capital defense clinics or prosecution externships as these practice areas receive renewed attention.\n\n2. Career Counseling Needs: Law School and graduate program career advisors may need updated guidance for students interested in careers intersecting with federal criminal justice systems.\n\n3. Student Research: Dissertation topics, independent studies, and student-led research initiatives addressing criminal justice policy may see evolving interest patterns.\n\n4. Pro Bono Opportunities: Student pro bono projects addressing criminal justice reform may experience changing contexts and engagement opportunities.\n\nRESOURCE IMPLICATIONS:\nThe resource impact will be concentrated in specific programs:\n\n1. Clinical Program Resources: Potential need for enhanced resources in Law School capital litigation clinics if caseloads increase, including supervision capacity, travel funding, and litigation support.\n\n2. Research Support: Targeted resources for faculty conducting empirical research or policy analysis related to evolving federal capital punishment approaches.\n\n3. Event Programming: Modest funding for academic events, symposia, or speaker series addressing changing federal criminal justice policies and their implications.\n\n4. Library Resources: Potential adjustments to acquisition priorities for specialized legal resources related to federal capital litigation.\n\nThe executive order represents a medium impact on specific Yale University programs, particularly at Yale Law School and in related academic fields addressing criminal justice policy. While not affecting most university operations, it creates meaningful considerations for specialized educational, clinical, and research activities. The primary university impact areas will be Research Funding (for criminal justice scholarship) and Administrative Compliance (for clinical programs engaged with federal criminal cases). Yale should prepare for increased activity and interest in these specialized domains while maintaining balanced academic approaches to complex policy questions.",
          impactLevel: "Medium",
          categories: ["Education"],
          universityImpactAreas: ["Research Funding", "Administrative Compliance"]
        }
      }
    ];

    let successCount = 0;
    
    // Process the batch analysis
    for (const item of batchAnalysis) {
      try {
        console.log(`\nProcessing order with number: ${item.order_number} - ${item.title}`);
        
        // Find the order in our database
        const order = await dbGet(
          'SELECT id, order_number, title FROM executive_orders WHERE order_number = ?', 
          [item.order_number]
        );
        
        if (!order) {
          console.log(`Order not found in database: ${item.order_number}`);
          continue;
        }
        
        // Update order with analysis
        const success = await updateOrderWithAnalysis(order.id, item.analysis);
        if (success) {
          successCount++;
        }
      } catch (error) {
        console.error(`Error processing order ${item.order_number}:`, error);
      }
    }
    
    console.log(`\nAnalysis completed. Successfully analyzed ${successCount} out of ${batchAnalysis.length} orders.`);
    
  } catch (error) {
    console.error("Error in main process:", error);
  } finally {
    // Close the database connection
    db.close();
  }
}

// Run the main function
main();